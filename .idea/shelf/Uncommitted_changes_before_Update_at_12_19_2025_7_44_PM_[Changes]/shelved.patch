Index: app/src/main/java/com/example/vibebank/ForgotPasswordActivity.java
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/app/src/main/java/com/example/vibebank/ForgotPasswordActivity.java b/app/src/main/java/com/example/vibebank/ui/forgotpassword/ForgotPasswordActivity.java
rename from app/src/main/java/com/example/vibebank/ForgotPasswordActivity.java
rename to app/src/main/java/com/example/vibebank/ui/forgotpassword/ForgotPasswordActivity.java
--- a/app/src/main/java/com/example/vibebank/ForgotPasswordActivity.java	(revision 258f67465d9c97da1d54ee045196060b3376b7fb)
+++ b/app/src/main/java/com/example/vibebank/ui/forgotpassword/ForgotPasswordActivity.java	(date 1766138840447)
@@ -1,30 +1,50 @@
-package com.example.vibebank;
+package com.example.vibebank.ui.forgotpassword;
 
 import android.annotation.SuppressLint;
+import android.content.Context;
 import android.content.Intent;
+import android.graphics.Rect;
 import android.os.Bundle;
+import android.view.MotionEvent;
 import android.view.View;
+import android.view.inputmethod.InputMethodManager;
+import android.widget.EditText;
 import android.widget.ImageView;
 import android.widget.Toast;
 
 import androidx.activity.EdgeToEdge;
+import androidx.annotation.NonNull;
+import androidx.appcompat.app.AlertDialog;
 import androidx.appcompat.app.AppCompatActivity;
 import androidx.core.graphics.Insets;
 import androidx.core.view.ViewCompat;
 import androidx.core.view.WindowInsetsCompat;
+import androidx.lifecycle.ViewModelProvider;
 
-import com.example.vibebank.ui.register.OtpBottomSheetDialog;
+import com.example.vibebank.R;
+import com.example.vibebank.ui.OtpBottomSheetDialog;
 import com.google.android.material.button.MaterialButton;
 import com.google.android.material.textfield.TextInputEditText;
+import com.google.firebase.FirebaseException;
+import com.google.firebase.auth.FirebaseAuth;
+import com.google.firebase.auth.PhoneAuthCredential;
+import com.google.firebase.auth.PhoneAuthOptions;
+import com.google.firebase.auth.PhoneAuthProvider;
+
+import java.util.concurrent.TimeUnit;
 
 public class ForgotPasswordActivity extends AppCompatActivity {
     private static final String TAG = "ForgotPasswordActivity";
 
     private ImageView btnBack;
     private MaterialButton btnNext;
-    private TextInputEditText edtFullName;
-    private TextInputEditText edtCCCD;
-    private TextInputEditText edtPhone;
+    private TextInputEditText edtFullName, edtCCCD, edtPhone;
+
+    // ViewModel & Auth
+    private ForgotPasswordViewModel viewModel;
+    private FirebaseAuth mAuth;
+    private String mVerificationId;
+    private String matchedUid; // Lưu UID tìm được để gửi sang màn hình Reset
 
     @SuppressLint("MissingInflatedId")
     @Override
@@ -33,66 +53,178 @@
         EdgeToEdge.enable(this);
         setContentView(R.layout.activity_forgot_password);
 
+        // Setup Insets ...
         ViewCompat.setOnApplyWindowInsetsListener(findViewById(R.id.forgotPassword), (v, insets) -> {
             Insets systemBars = insets.getInsets(WindowInsetsCompat.Type.systemBars());
             v.setPadding(systemBars.left, systemBars.top, systemBars.right, systemBars.bottom);
             return insets;
         });
 
+        mAuth = FirebaseAuth.getInstance();
+        viewModel = new ViewModelProvider(this).get(ForgotPasswordViewModel.class);
+
+        initViews();
+        setupObservers();
+
+        btnBack.setOnClickListener(v -> finish());
+
+        btnNext.setOnClickListener(v -> {
+            String fullName = edtFullName.getText().toString().trim();
+            String cccd = edtCCCD.getText().toString().trim();
+            String phone = edtPhone.getText().toString().trim();
+
+            if (fullName.isEmpty() || cccd.isEmpty() || phone.isEmpty()) {
+                showErrorDialog("Vui lòng điền đầy đủ thông tin");
+                return;
+            }
+
+            // 1. Gọi ViewModel kiểm tra thông tin trong Database trước
+            viewModel.verifyUserInfo(fullName, cccd, phone);
+        });
+    }
+
+    private void initViews() {
         btnBack = findViewById(R.id.btnBack);
         btnNext = findViewById(R.id.btnNext);
         edtFullName = findViewById(R.id.edtFullName);
         edtCCCD = findViewById(R.id.edtCCCD);
         edtPhone = findViewById(R.id.edtPhone);
+    }
+
+    private void setupObservers() {
+        // Lắng nghe lỗi
+        viewModel.errorMessage.observe(this, error -> {
+            if (error != null) {
+                showErrorDialog(error);
+                // Reset error để tránh hiện lại khi xoay màn hình
+                viewModel.errorMessage.setValue(null);
+            }
+        });
 
-        btnBack.setOnClickListener(new View.OnClickListener() {
-            @Override
-            public void onClick(View v) {
-                finish();
-            }
-        });
+        // Lắng nghe loading
+        viewModel.isLoading.observe(this, isLoading -> {
+            btnNext.setEnabled(!isLoading);
+            btnNext.setText(isLoading ? "Đang kiểm tra..." : "Tiếp tục");
+        });
+
+        // Lắng nghe kết quả thành công (Tìm thấy UID khớp)
+        viewModel.verifiedUid.observe(this, uid -> {
+            if (uid != null) {
+                this.matchedUid = uid;
+                // 2. Thông tin khớp -> Bắt đầu gửi OTP
+                String phoneRaw = edtPhone.getText().toString().trim();
+                String phoneFormatted = phoneRaw.startsWith("0") ? "+84" + phoneRaw.substring(1) : phoneRaw;
+                sendSmsOtp(phoneFormatted);
+            }
+        });
+    }
+
+    private void sendSmsOtp(String phoneNumber) {
+        btnNext.setEnabled(false);
+        btnNext.setText("Đang gửi OTP...");
+
+        PhoneAuthOptions options = PhoneAuthOptions.newBuilder(mAuth)
+                .setPhoneNumber(phoneNumber)
+                .setTimeout(60L, TimeUnit.SECONDS)
+                .setActivity(this)
+                .setCallbacks(mCallbacks)
+                .build();
+        PhoneAuthProvider.verifyPhoneNumber(options);
+    }
+
+    private final PhoneAuthProvider.OnVerificationStateChangedCallbacks mCallbacks =
+            new PhoneAuthProvider.OnVerificationStateChangedCallbacks() {
+                @Override
+                public void onVerificationCompleted(@NonNull PhoneAuthCredential credential) {
+                    // Auto verify (ít khi xảy ra nếu không dùng Instant Verification)
+                    String code = credential.getSmsCode();
+                    if (code != null) {
+                        verifyOtpCode(code); // Tự động verify luôn
+                    }
+                }
 
-        btnNext.setOnClickListener(new View.OnClickListener() {
-            @Override
-            public void onClick(View v) {
-                String fullName = edtFullName.getText().toString().trim();
-                String cccd = edtCCCD.getText().toString().trim();
-                String phone = edtPhone.getText().toString().trim();
-
-                // Validate inputs
-                if (fullName.isEmpty() || cccd.isEmpty() || phone.isEmpty()) {
-                    Toast.makeText(ForgotPasswordActivity.this, "Vui lòng điền đầy đủ thông tin", Toast.LENGTH_SHORT).show();
-                    return;
+                @Override
+                public void onVerificationFailed(@NonNull FirebaseException e) {
+                    btnNext.setEnabled(true);
+                    btnNext.setText("Tiếp tục");
+                    showErrorDialog("Gửi OTP thất bại: " + e.getMessage());
                 }
 
-                // Show OTP dialog
-                showOtpDialog(phone, fullName, cccd);
-            }
-        });
-    }
+                @Override
+                public void onCodeSent(@NonNull String verificationId,
+                                       @NonNull PhoneAuthProvider.ForceResendingToken token) {
+                    btnNext.setEnabled(true);
+                    btnNext.setText("Tiếp tục");
+                    mVerificationId = verificationId;
+
+                    // Hiện Dialog nhập OTP
+                    showOtpDialog();
+                }
+            };
 
-    private void showOtpDialog(String phone, String fullName, String cccd) {
-        OtpBottomSheetDialog otpDialog = OtpBottomSheetDialog.newInstance("Email/Phone của bạn");
+    private void showOtpDialog() {
+        String phoneDisplay = edtPhone.getText().toString();
+        OtpBottomSheetDialog otpDialog = OtpBottomSheetDialog.newInstance(phoneDisplay);
+
         otpDialog.setOtpVerificationListener(new OtpBottomSheetDialog.OtpVerificationListener() {
             @Override
             public void onOtpVerified(String otp) {
-                // TODO: Verify OTP with backend
-                Toast.makeText(ForgotPasswordActivity.this, "Xác thực OTP thành công!", Toast.LENGTH_SHORT).show();
-                
-                // Navigate to reset password screen
-                Intent intent = new Intent(ForgotPasswordActivity.this, ResetPasswordActivity.class);
-                intent.putExtra("phone", phone);
-                intent.putExtra("fullName", fullName);
-                intent.putExtra("cccd", cccd);
-                startActivity(intent);
+                verifyOtpCode(otp);
             }
 
             @Override
             public void onResendOtp() {
-                // TODO: Resend OTP
-                Toast.makeText(ForgotPasswordActivity.this, "Đã gửi lại mã OTP", Toast.LENGTH_SHORT).show();
+                String phoneRaw = edtPhone.getText().toString().trim();
+                String phoneFormatted = phoneRaw.startsWith("0") ? "+84" + phoneRaw.substring(1) : phoneRaw;
+                sendSmsOtp(phoneFormatted);
             }
         });
         otpDialog.show(getSupportFragmentManager(), "OtpBottomSheet");
     }
-}
+
+    private void verifyOtpCode(String code) {
+        PhoneAuthCredential credential = PhoneAuthProvider.getCredential(mVerificationId, code);
+
+        mAuth.signInWithCredential(credential).addOnCompleteListener(this, task -> {
+            if (task.isSuccessful()) {
+                Toast.makeText(ForgotPasswordActivity.this, "Xác thực thành công!", Toast.LENGTH_SHORT).show();
+
+                // 3. Chuyển sang ResetPasswordActivity
+                Intent intent = new Intent(ForgotPasswordActivity.this, ResetPasswordActivity.class);
+                intent.putExtra("uid", matchedUid); // Gửi UID sang để biết cần đổi pass của ai
+                intent.putExtra("phone", edtPhone.getText().toString());
+                startActivity(intent);
+                finish(); // Đóng màn hình này lại
+            } else {
+                Toast.makeText(ForgotPasswordActivity.this, "Mã OTP không đúng", Toast.LENGTH_SHORT).show();
+            }
+        });
+    }
+
+    private void showErrorDialog(String msg) {
+        new AlertDialog.Builder(this)
+                .setTitle("Thông báo")
+                .setMessage(msg)
+                .setPositiveButton("Đóng", null)
+                .show();
+    }
+
+    @Override
+    public boolean dispatchTouchEvent(MotionEvent event) {
+        if (event.getAction() == MotionEvent.ACTION_DOWN) {
+            View v = getCurrentFocus();
+            if (v instanceof EditText) {
+                Rect outRect = new Rect();
+                v.getGlobalVisibleRect(outRect);
+                if (!outRect.contains((int)event.getRawX(), (int)event.getRawY())) {
+                    v.clearFocus();
+                    InputMethodManager imm = (InputMethodManager) getSystemService(Context.INPUT_METHOD_SERVICE);
+                    if (imm != null) {
+                        imm.hideSoftInputFromWindow(v.getWindowToken(), 0);
+                    }
+                }
+            }
+        }
+        return super.dispatchTouchEvent(event);
+    }
+}
\ No newline at end of file
Index: app/src/main/java/com/example/vibebank/ui/login/LoginActivity.java
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+>package com.example.vibebank.ui.login;\r\n\r\nimport android.content.Intent;\r\nimport android.os.Bundle;\r\nimport android.view.View;\r\nimport android.widget.EditText;\r\nimport android.widget.TextView;\r\nimport android.widget.Toast;\r\n\r\nimport androidx.activity.EdgeToEdge;\r\nimport androidx.appcompat.app.AppCompatActivity;\r\n\r\nimport com.example.vibebank.ForgotPasswordActivity;\r\nimport com.example.vibebank.HomeActivity;\r\nimport com.example.vibebank.R;\r\nimport com.example.vibebank.ui.register.RegisterActivity;\r\nimport com.google.android.material.button.MaterialButton;\r\n\r\npublic class LoginActivity extends AppCompatActivity {\r\n    private static final String TAG = \"LoginActivity\";\r\n\r\n    private EditText etUsername;\r\n    private EditText etPassword;\r\n    private TextView txtCreateAccount;\r\n    private TextView txtForgotPassword;\r\n    private MaterialButton btnLogin;\r\n\r\n    @Override\r\n    protected void onCreate(Bundle savedInstanceState) {\r\n        super.onCreate(savedInstanceState);\r\n        EdgeToEdge.enable(this);\r\n        setContentView(R.layout.activity_login);\r\n\r\n        etUsername = findViewById(R.id.edit_text_username);\r\n        etPassword = findViewById(R.id.edit_text_password);\r\n        txtCreateAccount = findViewById(R.id.text_create_account);\r\n        txtForgotPassword = findViewById(R.id.text_forgot_password);\r\n        btnLogin = findViewById(R.id.button_login);\r\n\r\n        txtCreateAccount.setOnClickListener(new View.OnClickListener() {\r\n            @Override\r\n            public void onClick(View v) {\r\n                Intent intent = new Intent(LoginActivity.this, RegisterActivity.class);\r\n                startActivity(intent);\r\n            }\r\n        });\r\n\r\n        txtForgotPassword.setOnClickListener(new View.OnClickListener() {\r\n            @Override\r\n            public void onClick(View v) {\r\n                Intent intent = new Intent(LoginActivity.this, ForgotPasswordActivity.class);\r\n                startActivity(intent);\r\n            }\r\n        });\r\n\r\n        btnLogin.setOnClickListener(new View.OnClickListener() {\r\n            @Override\r\n            public void onClick(View v) {\r\n                String username = etUsername.getText().toString().trim();\r\n                String password = etPassword.getText().toString().trim();\r\n\r\n                if (username.isEmpty() || password.isEmpty()) {\r\n                    Toast.makeText(LoginActivity.this, \"Vui lòng điền đầy đủ thông tin\", Toast.LENGTH_SHORT).show();\r\n                    return;\r\n                }\r\n\r\n                // TODO: Validate with backend API\r\n                // For now, just navigate to HomeActivity\r\n                Intent intent = new Intent(LoginActivity.this, HomeActivity.class);\r\n                intent.putExtra(\"userName\", username);\r\n                startActivity(intent);\r\n                finish();\r\n            }\r\n        });\r\n\r\n        }\r\n    }\r\n
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/app/src/main/java/com/example/vibebank/ui/login/LoginActivity.java b/app/src/main/java/com/example/vibebank/ui/login/LoginActivity.java
--- a/app/src/main/java/com/example/vibebank/ui/login/LoginActivity.java	(revision 258f67465d9c97da1d54ee045196060b3376b7fb)
+++ b/app/src/main/java/com/example/vibebank/ui/login/LoginActivity.java	(date 1766138218515)
@@ -1,20 +1,27 @@
 package com.example.vibebank.ui.login;
 
+import android.content.Context;
 import android.content.Intent;
+import android.graphics.Rect;
 import android.os.Bundle;
+import android.view.MotionEvent;
 import android.view.View;
+import android.view.inputmethod.InputMethodManager;
 import android.widget.EditText;
+import android.widget.ProgressBar;
 import android.widget.TextView;
-import android.widget.Toast;
 
 import androidx.activity.EdgeToEdge;
 import androidx.appcompat.app.AppCompatActivity;
+import androidx.lifecycle.ViewModelProvider;
 
-import com.example.vibebank.ForgotPasswordActivity;
+import com.example.vibebank.ui.forgotpassword.ForgotPasswordActivity;
 import com.example.vibebank.HomeActivity;
 import com.example.vibebank.R;
 import com.example.vibebank.ui.register.RegisterActivity;
+import com.example.vibebank.utils.SessionManager;
 import com.google.android.material.button.MaterialButton;
+import com.google.android.material.dialog.MaterialAlertDialogBuilder;
 
 public class LoginActivity extends AppCompatActivity {
     private static final String TAG = "LoginActivity";
@@ -24,54 +31,138 @@
     private TextView txtCreateAccount;
     private TextView txtForgotPassword;
     private MaterialButton btnLogin;
+    private ProgressBar progressBar;
+
+    private LoginViewModel viewModel;
+    private SessionManager sessionManager;
 
     @Override
     protected void onCreate(Bundle savedInstanceState) {
         super.onCreate(savedInstanceState);
         EdgeToEdge.enable(this);
+
+        // Check Session
+        sessionManager = new SessionManager(this);
+        if (sessionManager.isLoggedIn()) {
+            navigateToHome();
+            return;
+        }
+
         setContentView(R.layout.activity_login);
 
+        viewModel = new ViewModelProvider(this).get(LoginViewModel.class);
+
+        initViews();
+        setupListeners();
+        setupObservers();
+    }
+
+    private void initViews() {
         etUsername = findViewById(R.id.edit_text_username);
         etPassword = findViewById(R.id.edit_text_password);
         txtCreateAccount = findViewById(R.id.text_create_account);
         txtForgotPassword = findViewById(R.id.text_forgot_password);
         btnLogin = findViewById(R.id.button_login);
+        progressBar = findViewById(R.id.progressBar);
+    }
 
-        txtCreateAccount.setOnClickListener(new View.OnClickListener() {
-            @Override
-            public void onClick(View v) {
-                Intent intent = new Intent(LoginActivity.this, RegisterActivity.class);
-                startActivity(intent);
-            }
+    private void setupListeners() {
+        txtCreateAccount.setOnClickListener(v -> {
+            Intent intent = new Intent(LoginActivity.this, RegisterActivity.class);
+            startActivity(intent);
         });
 
-        txtForgotPassword.setOnClickListener(new View.OnClickListener() {
-            @Override
-            public void onClick(View v) {
-                Intent intent = new Intent(LoginActivity.this, ForgotPasswordActivity.class);
-                startActivity(intent);
+        txtForgotPassword.setOnClickListener(v -> {
+            Intent intent = new Intent(LoginActivity.this, ForgotPasswordActivity.class);
+            startActivity(intent);
+        });
+
+        btnLogin.setOnClickListener(v -> {
+            InputMethodManager imm = (InputMethodManager) getSystemService(Context.INPUT_METHOD_SERVICE);
+            View currentFocus = getCurrentFocus();
+            if (imm != null && currentFocus != null) {
+                imm.hideSoftInputFromWindow(currentFocus.getWindowToken(), 0);
             }
-        });
 
-        btnLogin.setOnClickListener(new View.OnClickListener() {
-            @Override
-            public void onClick(View v) {
-                String username = etUsername.getText().toString().trim();
-                String password = etPassword.getText().toString().trim();
+            String phone = etUsername.getText().toString().trim();
+            String password = etPassword.getText().toString().trim();
+            viewModel.login(phone, password);
+        });
+    }
+
+    private void setupObservers() {
+        // Lắng nghe kết quả
+        viewModel.loginResult.observe(this, errorMsg -> {
+            if (errorMsg == null) {
+                sessionManager.createLoginSession(
+                        viewModel.successUserId,
+                        etUsername.getText().toString().trim(),
+                        viewModel.successFullName
+                );
+                navigateToHome();
+            } else {
+                showErrorDialog(errorMsg);
+            }
+        });
+
+        // Lắng nghe loading
+        viewModel.isLoading.observe(this, isLoading -> {
+            if (isLoading) {
+                if (progressBar != null) progressBar.setVisibility(View.VISIBLE);
+                btnLogin.setEnabled(false);
+                btnLogin.setText("Đang xử lý...");
+                btnLogin.setAlpha(0.7f);
+            } else {
+                if (progressBar != null) progressBar.setVisibility(View.GONE);
+                btnLogin.setEnabled(true);
+                btnLogin.setText("Đăng nhập");
+                btnLogin.setAlpha(1.0f);
+            }
+        });
+    }
+
+    private void showErrorDialog(String message) {
+        android.graphics.drawable.Drawable icon = androidx.core.content.ContextCompat.getDrawable(this, android.R.drawable.ic_dialog_alert);
 
-                if (username.isEmpty() || password.isEmpty()) {
-                    Toast.makeText(LoginActivity.this, "Vui lòng điền đầy đủ thông tin", Toast.LENGTH_SHORT).show();
-                    return;
-                }
+        if (icon != null) {
+            icon = androidx.core.graphics.drawable.DrawableCompat.wrap(icon).mutate();
+            androidx.core.graphics.drawable.DrawableCompat.setTint(icon, android.graphics.Color.parseColor("#FFC107"));
+        }
+        androidx.appcompat.app.AlertDialog dialog = new MaterialAlertDialogBuilder(this)
+                .setTitle("Thông báo")
+                .setMessage(message)
+                .setIcon(icon)
+                .setPositiveButton("Đóng", (d, w) -> {
+                    d.dismiss();
+                    etPassword.setText("");
+                })
+                .show();
+        dialog.getButton(androidx.appcompat.app.AlertDialog.BUTTON_POSITIVE)
+                .setTextColor(android.graphics.Color.parseColor("#4CAF50"));
+    }
 
-                // TODO: Validate with backend API
-                // For now, just navigate to HomeActivity
-                Intent intent = new Intent(LoginActivity.this, HomeActivity.class);
-                intent.putExtra("userName", username);
-                startActivity(intent);
-                finish();
-            }
-        });
-
-        }
+    @Override
+    public boolean dispatchTouchEvent(MotionEvent event) {
+        if (event.getAction() == MotionEvent.ACTION_DOWN) {
+            View v = getCurrentFocus();
+            if (v instanceof EditText) {
+                Rect outRect = new Rect();
+                v.getGlobalVisibleRect(outRect);
+                if (!outRect.contains((int)event.getRawX(), (int)event.getRawY())) {
+                    v.clearFocus();
+                    InputMethodManager imm = (InputMethodManager) getSystemService(Context.INPUT_METHOD_SERVICE);
+                    if (imm != null) {
+                        imm.hideSoftInputFromWindow(v.getWindowToken(), 0);
+                    }
+                }
+            }
+        }
+        return super.dispatchTouchEvent(event);
+    }
+
+    private void navigateToHome() {
+        Intent intent = new Intent(LoginActivity.this, HomeActivity.class);
+        startActivity(intent);
+        finish();
     }
+}
\ No newline at end of file
Index: app/src/main/res/layout/activity_forgot_password.xml
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+><?xml version=\"1.0\" encoding=\"utf-8\"?>\r\n<LinearLayout xmlns:android=\"http://schemas.android.com/apk/res/android\"\r\n    xmlns:app=\"http://schemas.android.com/apk/res-auto\"\r\n    android:layout_width=\"match_parent\"\r\n    android:layout_height=\"match_parent\"\r\n    android:orientation=\"vertical\"\r\n    android:background=\"#FFFFFF\"\r\n    android:id=\"@+id/forgotPassword\">\r\n\r\n    <!-- App Bar -->\r\n    <LinearLayout\r\n        android:id=\"@+id/appbar\"\r\n        android:layout_width=\"match_parent\"\r\n        android:layout_height=\"56dp\"\r\n        android:orientation=\"horizontal\"\r\n        android:gravity=\"center_vertical\"\r\n        android:paddingStart=\"16dp\"\r\n        android:paddingEnd=\"16dp\"\r\n        android:elevation=\"10dp\"\r\n        android:background=\"@color/white\">\r\n\r\n        <ImageView\r\n            android:id=\"@+id/btnBack\"\r\n            android:layout_width=\"24dp\"\r\n            android:layout_height=\"24dp\"\r\n            android:src=\"@drawable/outline_arrow_back_ios_new_24\"\r\n            app:tint=\"#000000\" />\r\n\r\n        <TextView\r\n            android:layout_width=\"wrap_content\"\r\n            android:layout_height=\"wrap_content\"\r\n            android:layout_marginStart=\"12dp\"\r\n            android:text=\"Quên mật khẩu\"\r\n            android:textSize=\"18sp\"\r\n            android:textStyle=\"bold\"\r\n            android:textColor=\"#000000\"\r\n            android:fontFamily=\"@font/nunito_sans\" />\r\n\r\n    </LinearLayout>\r\n\r\n    <!-- Body -->\r\n    <ScrollView\r\n        android:layout_width=\"match_parent\"\r\n        android:layout_height=\"0dp\"\r\n        android:layout_weight=\"1\"\r\n        android:fillViewport=\"true\">\r\n\r\n        <LinearLayout\r\n            android:layout_width=\"match_parent\"\r\n            android:layout_height=\"wrap_content\"\r\n            android:orientation=\"vertical\"\r\n            android:padding=\"20dp\"\r\n            android:paddingBottom=\"100dp\">\r\n\r\n            <TextView\r\n                android:layout_width=\"wrap_content\"\r\n                android:layout_height=\"wrap_content\"\r\n                android:text=\"Yêu cầu cấp lại mật khẩu:\"\r\n                android:textSize=\"14sp\"\r\n                android:textStyle=\"bold\"\r\n                android:textColor=\"#000000\"\r\n                android:fontFamily=\"@font/nunito_sans\"\r\n                android:layout_marginBottom=\"8dp\" />\r\n\r\n            <TextView\r\n                android:layout_width=\"wrap_content\"\r\n                android:layout_height=\"wrap_content\"\r\n                android:text=\"Vui lòng nhập thông tin cơ bản của bạn\"\r\n                android:textSize=\"14sp\"\r\n                android:textColor=\"#666666\"\r\n                android:fontFamily=\"@font/nunito_sans\"\r\n                android:layout_marginBottom=\"16dp\" />\r\n\r\n            <!-- Họ và tên -->\r\n            <androidx.cardview.widget.CardView\r\n                android:layout_width=\"match_parent\"\r\n                android:layout_height=\"wrap_content\"\r\n                android:layout_marginBottom=\"16dp\"\r\n                app:cardCornerRadius=\"4dp\"\r\n                app:cardElevation=\"4dp\"\r\n                app:cardMaxElevation=\"4dp\"\r\n                app:cardUseCompatPadding=\"true\"\r\n                app:cardBackgroundColor=\"#FFFFFF\">\r\n\r\n                <com.google.android.material.textfield.TextInputLayout\r\n                    android:id=\"@+id/tilFullName\"\r\n                    style=\"@style/Widget.MaterialComponents.TextInputLayout.FilledBox.Dense\"\r\n                    android:layout_width=\"match_parent\"\r\n                    android:layout_height=\"wrap_content\"\r\n                    android:hint=\"HỌ VÀ TÊN\"\r\n                    app:boxBackgroundColor=\"@android:color/transparent\"\r\n                    app:boxStrokeWidth=\"0dp\"\r\n                    app:boxStrokeWidthFocused=\"0dp\"\r\n                    android:textColorHint=\"#A3A3A3\"\r\n                    app:hintTextColor=\"@color/text_input_hint_color\">\r\n\r\n                    <com.google.android.material.textfield.TextInputEditText\r\n                        android:id=\"@+id/edtFullName\"\r\n                        android:layout_width=\"match_parent\"\r\n                        android:layout_height=\"wrap_content\"\r\n                        android:fontFamily=\"@font/nunito_sans\"\r\n                        android:inputType=\"textPersonName\"\r\n                        android:textColor=\"@color/black\"\r\n                        android:background=\"@color/white\"\r\n                        android:textCursorDrawable=\"@drawable/cursor_black\"\r\n                        android:textSize=\"16sp\" />\r\n                </com.google.android.material.textfield.TextInputLayout>\r\n\r\n            </androidx.cardview.widget.CardView>\r\n\r\n            <!-- Số căn cước/CCCD -->\r\n            <androidx.cardview.widget.CardView\r\n                android:layout_width=\"match_parent\"\r\n                android:layout_height=\"wrap_content\"\r\n                android:layout_marginBottom=\"16dp\"\r\n                app:cardCornerRadius=\"4dp\"\r\n                app:cardElevation=\"4dp\"\r\n                app:cardMaxElevation=\"4dp\"\r\n                app:cardUseCompatPadding=\"true\"\r\n                app:cardBackgroundColor=\"#FFFFFF\">\r\n\r\n                <com.google.android.material.textfield.TextInputLayout\r\n                    android:id=\"@+id/tilCCCD\"\r\n                    style=\"@style/Widget.MaterialComponents.TextInputLayout.FilledBox.Dense\"\r\n                    android:layout_width=\"match_parent\"\r\n                    android:layout_height=\"wrap_content\"\r\n                    android:hint=\"SỐ CĂN CƯỚC/CCCD\"\r\n                    app:boxBackgroundColor=\"@android:color/transparent\"\r\n                    app:boxStrokeWidth=\"0dp\"\r\n                    app:boxStrokeWidthFocused=\"0dp\"\r\n                    android:textColorHint=\"#A3A3A3\"\r\n                    app:hintTextColor=\"@color/text_input_hint_color\">\r\n\r\n                    <com.google.android.material.textfield.TextInputEditText\r\n                        android:id=\"@+id/edtCCCD\"\r\n                        android:layout_width=\"match_parent\"\r\n                        android:layout_height=\"wrap_content\"\r\n                        android:fontFamily=\"@font/nunito_sans\"\r\n                        android:inputType=\"text\"\r\n                        android:textColor=\"@color/black\"\r\n                        android:background=\"@color/white\"\r\n                        android:textCursorDrawable=\"@drawable/cursor_black\"\r\n                        android:textSize=\"16sp\" />\r\n                </com.google.android.material.textfield.TextInputLayout>\r\n\r\n            </androidx.cardview.widget.CardView>\r\n\r\n            <!-- Số điện thoại -->\r\n            <androidx.cardview.widget.CardView\r\n                android:layout_width=\"match_parent\"\r\n                android:layout_height=\"wrap_content\"\r\n                android:layout_marginBottom=\"16dp\"\r\n                app:cardCornerRadius=\"4dp\"\r\n                app:cardElevation=\"4dp\"\r\n                app:cardMaxElevation=\"4dp\"\r\n                app:cardUseCompatPadding=\"true\"\r\n                app:cardBackgroundColor=\"#FFFFFF\">\r\n\r\n                <com.google.android.material.textfield.TextInputLayout\r\n                    android:id=\"@+id/tilPhone\"\r\n                    style=\"@style/Widget.MaterialComponents.TextInputLayout.FilledBox.Dense\"\r\n                    android:layout_width=\"match_parent\"\r\n                    android:layout_height=\"wrap_content\"\r\n                    android:hint=\"SỐ ĐIỆN THOẠI\"\r\n                    app:boxBackgroundColor=\"@android:color/transparent\"\r\n                    app:boxStrokeWidth=\"0dp\"\r\n                    app:boxStrokeWidthFocused=\"0dp\"\r\n                    android:textColorHint=\"#A3A3A3\"\r\n                    app:hintTextColor=\"@color/text_input_hint_color\">\r\n\r\n                    <com.google.android.material.textfield.TextInputEditText\r\n                        android:id=\"@+id/edtPhone\"\r\n                        android:layout_width=\"match_parent\"\r\n                        android:layout_height=\"wrap_content\"\r\n                        android:fontFamily=\"@font/nunito_sans\"\r\n                        android:inputType=\"phone\"\r\n                        android:textColor=\"@color/black\"\r\n                        android:background=\"@color/white\"\r\n                        android:textCursorDrawable=\"@drawable/cursor_black\"\r\n                        android:textSize=\"16sp\" />\r\n                </com.google.android.material.textfield.TextInputLayout>\r\n\r\n            </androidx.cardview.widget.CardView>\r\n\r\n        </LinearLayout>\r\n    </ScrollView>\r\n\r\n    <!-- Nút tiếp theo -->\r\n    <com.google.android.material.button.MaterialButton\r\n        android:id=\"@+id/btnNext\"\r\n        android:layout_width=\"match_parent\"\r\n        android:layout_height=\"56dp\"\r\n        android:layout_marginStart=\"20dp\"\r\n        android:layout_marginEnd=\"20dp\"\r\n        android:layout_marginBottom=\"20dp\"\r\n        android:text=\"TIẾP THEO\"\r\n        android:textColor=\"#FFFFFF\"\r\n        android:textStyle=\"bold\"\r\n        android:textSize=\"16sp\"\r\n        android:fontFamily=\"@font/nunito_sans\"\r\n        android:backgroundTint=\"#000000\"\r\n        app:cornerRadius=\"5dp\" />\r\n\r\n</LinearLayout>\r\n
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/app/src/main/res/layout/activity_forgot_password.xml b/app/src/main/res/layout/activity_forgot_password.xml
--- a/app/src/main/res/layout/activity_forgot_password.xml	(revision 258f67465d9c97da1d54ee045196060b3376b7fb)
+++ b/app/src/main/res/layout/activity_forgot_password.xml	(date 1766138840453)
@@ -136,7 +136,7 @@
                         android:layout_width="match_parent"
                         android:layout_height="wrap_content"
                         android:fontFamily="@font/nunito_sans"
-                        android:inputType="text"
+                        android:inputType="number"
                         android:textColor="@color/black"
                         android:background="@color/white"
                         android:textCursorDrawable="@drawable/cursor_black"
Index: app/src/main/java/com/example/vibebank/ui/register/Register5Activity.java
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+>package com.example.vibebank.ui.register;\r\n\r\nimport android.annotation.SuppressLint;\r\nimport android.os.Bundle;\r\nimport android.util.Log;\r\nimport android.view.View;\r\nimport android.widget.ImageView;\r\nimport android.widget.Toast;\r\n\r\nimport androidx.activity.EdgeToEdge;\r\nimport androidx.appcompat.app.AppCompatActivity;\r\nimport androidx.core.graphics.Insets;\r\nimport androidx.core.view.ViewCompat;\r\nimport androidx.core.view.WindowInsetsCompat;\r\n\r\nimport com.example.vibebank.R;\r\nimport com.google.android.material.button.MaterialButton;\r\nimport com.google.android.material.textfield.TextInputEditText;\r\n\r\nimport java.util.regex.Pattern;\r\n\r\npublic class Register5Activity extends AppCompatActivity {\r\n    private static final String TAG = \"Register5Activity\";\r\n\r\n    private ImageView btnBack;\r\n    private MaterialButton btnCreateAccount;\r\n    private TextInputEditText edtUsername;\r\n    private TextInputEditText edtPassword;\r\n    private TextInputEditText edtConfirmPassword;\r\n    \r\n    private String phone;\r\n\r\n    @SuppressLint(\"MissingInflatedId\")\r\n    @Override\r\n    protected void onCreate(Bundle savedInstanceState) {\r\n        super.onCreate(savedInstanceState);\r\n        EdgeToEdge.enable(this);\r\n        setContentView(R.layout.activity_register5);\r\n\r\n        ViewCompat.setOnApplyWindowInsetsListener(findViewById(R.id.register5), (v, insets) -> {\r\n            Insets systemBars = insets.getInsets(WindowInsetsCompat.Type.systemBars());\r\n            v.setPadding(systemBars.left, systemBars.top, systemBars.right, systemBars.bottom);\r\n            return insets;\r\n        });\r\n\r\n        btnBack = findViewById(R.id.btnBack);\r\n        btnCreateAccount = findViewById(R.id.btnCreateAccount);\r\n        edtUsername = findViewById(R.id.edtUsername);\r\n        edtPassword = findViewById(R.id.edtPassword);\r\n        edtConfirmPassword = findViewById(R.id.edtConfirmPassword);\r\n\r\n        // Get phone number from previous screen\r\n        try {\r\n            phone = getIntent().getStringExtra(\"phone\");\r\n            if (phone != null && !phone.isEmpty()) {\r\n                edtUsername.setText(phone);\r\n            }\r\n            Log.d(TAG, \"Phone received: \" + phone);\r\n        } catch (Exception e) {\r\n            Log.e(TAG, \"Error getting phone data\", e);\r\n            Toast.makeText(this, \"Lỗi nhận dữ liệu: \" + e.getMessage(), Toast.LENGTH_LONG).show();\r\n        }\r\n\r\n        btnBack.setOnClickListener(new View.OnClickListener() {\r\n            @Override\r\n            public void onClick(View v) {\r\n                finish();\r\n            }\r\n        });\r\n\r\n        btnCreateAccount.setOnClickListener(new View.OnClickListener() {\r\n            @Override\r\n            public void onClick(View v) {\r\n                if (validateInput()) {\r\n                    // TODO: Call API to create account\r\n                    Toast.makeText(Register5Activity.this, \"Tạo tài khoản thành công!\", Toast.LENGTH_LONG).show();\r\n                    // Navigate to login or main screen\r\n                    finish();\r\n                }\r\n            }\r\n        });\r\n    }\r\n\r\n    private boolean validateInput() {\r\n        String password = edtPassword.getText() != null ? edtPassword.getText().toString() : \"\";\r\n        String confirmPassword = edtConfirmPassword.getText() != null ? edtConfirmPassword.getText().toString() : \"\";\r\n\r\n        // Check if password is empty\r\n        if (password.isEmpty()) {\r\n            Toast.makeText(this, \"Vui lòng nhập mật khẩu\", Toast.LENGTH_SHORT).show();\r\n            return false;\r\n        }\r\n\r\n        // Check password length\r\n        if (password.length() < 8) {\r\n            Toast.makeText(this, \"Mật khẩu phải có ít nhất 8 ký tự\", Toast.LENGTH_SHORT).show();\r\n            return false;\r\n        }\r\n\r\n        // Check for uppercase\r\n        if (!Pattern.compile(\"[A-Z]\").matcher(password).find()) {\r\n            Toast.makeText(this, \"Mật khẩu phải có ít nhất 1 chữ hoa\", Toast.LENGTH_SHORT).show();\r\n            return false;\r\n        }\r\n\r\n        // Check for lowercase\r\n        if (!Pattern.compile(\"[a-z]\").matcher(password).find()) {\r\n            Toast.makeText(this, \"Mật khẩu phải có ít nhất 1 chữ thường\", Toast.LENGTH_SHORT).show();\r\n            return false;\r\n        }\r\n\r\n        // Check for digit\r\n        if (!Pattern.compile(\"[0-9]\").matcher(password).find()) {\r\n            Toast.makeText(this, \"Mật khẩu phải có ít nhất 1 chữ số\", Toast.LENGTH_SHORT).show();\r\n            return false;\r\n        }\r\n\r\n        // Check for special character\r\n        if (!Pattern.compile(\"[!@#$]\").matcher(password).find()) {\r\n            Toast.makeText(this, \"Mật khẩu phải có ít nhất 1 ký tự đặc biệt (!@#$)\", Toast.LENGTH_SHORT).show();\r\n            return false;\r\n        }\r\n\r\n        // Check if passwords match\r\n        if (!password.equals(confirmPassword)) {\r\n            Toast.makeText(this, \"Mật khẩu xác nhận không khớp\", Toast.LENGTH_SHORT).show();\r\n            return false;\r\n        }\r\n\r\n        return true;\r\n    }\r\n}\r\n
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/app/src/main/java/com/example/vibebank/ui/register/Register5Activity.java b/app/src/main/java/com/example/vibebank/ui/register/Register5Activity.java
--- a/app/src/main/java/com/example/vibebank/ui/register/Register5Activity.java	(revision 258f67465d9c97da1d54ee045196060b3376b7fb)
+++ b/app/src/main/java/com/example/vibebank/ui/register/Register5Activity.java	(date 1766117189351)
@@ -1,132 +1,218 @@
 package com.example.vibebank.ui.register;
 
-import android.annotation.SuppressLint;
+import android.content.Context;
+import android.content.Intent;
+import android.graphics.Color;
+import android.graphics.Rect;
 import android.os.Bundle;
-import android.util.Log;
+import android.text.Editable;
+import android.text.TextWatcher;
+import android.view.MotionEvent;
 import android.view.View;
+import android.view.inputmethod.InputMethodManager;
+import android.widget.EditText;
 import android.widget.ImageView;
+import android.widget.TextView;
 import android.widget.Toast;
 
-import androidx.activity.EdgeToEdge;
 import androidx.appcompat.app.AppCompatActivity;
-import androidx.core.graphics.Insets;
-import androidx.core.view.ViewCompat;
-import androidx.core.view.WindowInsetsCompat;
+import androidx.lifecycle.ViewModelProvider;
 
 import com.example.vibebank.R;
+// Giả sử bạn có LoginActivity, hãy import nó
+// import com.example.vibebank.ui.login.LoginActivity;
+import com.example.vibebank.ui.login.LoginActivity;
 import com.google.android.material.button.MaterialButton;
 import com.google.android.material.textfield.TextInputEditText;
 
 import java.util.regex.Pattern;
 
 public class Register5Activity extends AppCompatActivity {
-    private static final String TAG = "Register5Activity";
 
     private ImageView btnBack;
     private MaterialButton btnCreateAccount;
-    private TextInputEditText edtUsername;
-    private TextInputEditText edtPassword;
-    private TextInputEditText edtConfirmPassword;
-    
-    private String phone;
+    private TextInputEditText edtUsername, edtPassword, edtConfirmPassword;
+    private TextView tvRuleLength, tvRuleUpperLower, tvRuleDigit, tvRuleSpecial;
+
+    private RegisterViewModel viewModel;
 
-    @SuppressLint("MissingInflatedId")
+    private final int COLOR_DEFAULT = Color.parseColor("#666666");
+    private final int COLOR_SUCCESS = Color.parseColor("#4CAF50");
+
+    private static final String SPECIAL_CHARACTERS_REGEX = "[!@#$%^&*()_+\\-=\\[\\]{};':\"\\\\|,.<>\\/?~]";
+
     @Override
     protected void onCreate(Bundle savedInstanceState) {
         super.onCreate(savedInstanceState);
-        EdgeToEdge.enable(this);
         setContentView(R.layout.activity_register5);
 
-        ViewCompat.setOnApplyWindowInsetsListener(findViewById(R.id.register5), (v, insets) -> {
-            Insets systemBars = insets.getInsets(WindowInsetsCompat.Type.systemBars());
-            v.setPadding(systemBars.left, systemBars.top, systemBars.right, systemBars.bottom);
-            return insets;
+        viewModel = new ViewModelProvider(this).get(RegisterViewModel.class);
+
+        viewModel.registrationResult.observe(this, isSuccess -> {
+            if (isSuccess) {
+                Toast.makeText(this, "Tạo tài khoản thành công!", Toast.LENGTH_LONG).show();
+                // Chuyển về màn hình Login
+                Intent intent = new Intent(this, LoginActivity.class);
+                intent.setFlags(Intent.FLAG_ACTIVITY_NEW_TASK | Intent.FLAG_ACTIVITY_CLEAR_TASK);
+                startActivity(intent);
+                finishAffinity();
+            } else {
+                Toast.makeText(this, "Lỗi tạo tài khoản. Vui lòng thử lại!", Toast.LENGTH_SHORT).show();
+            }
         });
 
+        initViews();
+        setupData();
+        setupListeners();
+    }
+
+    private void initViews() {
         btnBack = findViewById(R.id.btnBack);
         btnCreateAccount = findViewById(R.id.btnCreateAccount);
         edtUsername = findViewById(R.id.edtUsername);
         edtPassword = findViewById(R.id.edtPassword);
         edtConfirmPassword = findViewById(R.id.edtConfirmPassword);
 
-        // Get phone number from previous screen
-        try {
-            phone = getIntent().getStringExtra("phone");
-            if (phone != null && !phone.isEmpty()) {
-                edtUsername.setText(phone);
-            }
-            Log.d(TAG, "Phone received: " + phone);
-        } catch (Exception e) {
-            Log.e(TAG, "Error getting phone data", e);
-            Toast.makeText(this, "Lỗi nhận dữ liệu: " + e.getMessage(), Toast.LENGTH_LONG).show();
-        }
+        tvRuleLength = findViewById(R.id.tvRuleLength);
+        tvRuleUpperLower = findViewById(R.id.tvRuleUpperLower);
+        tvRuleDigit = findViewById(R.id.tvRuleDigit);
+        tvRuleSpecial = findViewById(R.id.tvRuleSpecial);
+    }
+
+    private void setupData() {
+        // Tự động điền Username là SĐT (Read-only)
+        String phone = viewModel.getPhone();
+        if (phone != null) {
+            edtUsername.setText(phone);
+            edtUsername.setEnabled(false); // Không cho sửa username
+        }
+    }
 
-        btnBack.setOnClickListener(new View.OnClickListener() {
+    private void setupListeners() {
+        btnBack.setOnClickListener(v -> finish());
+
+        edtPassword.addTextChangedListener(new TextWatcher() {
             @Override
-            public void onClick(View v) {
-                finish();
-            }
-        });
+            public void beforeTextChanged(CharSequence s, int start, int count, int after) {}
 
-        btnCreateAccount.setOnClickListener(new View.OnClickListener() {
             @Override
-            public void onClick(View v) {
-                if (validateInput()) {
-                    // TODO: Call API to create account
-                    Toast.makeText(Register5Activity.this, "Tạo tài khoản thành công!", Toast.LENGTH_LONG).show();
-                    // Navigate to login or main screen
-                    finish();
-                }
+            public void onTextChanged(CharSequence s, int start, int before, int count) {
+                validatePasswordRealtime(s.toString());
             }
+
+            @Override
+            public void afterTextChanged(Editable s) {}
         });
-    }
+
+        edtPassword.setOnFocusChangeListener((v, hasFocus) -> {
+            if (!hasFocus) {
+                validatePassword(true);
+            }
+        });
 
-    private boolean validateInput() {
-        String password = edtPassword.getText() != null ? edtPassword.getText().toString() : "";
-        String confirmPassword = edtConfirmPassword.getText() != null ? edtConfirmPassword.getText().toString() : "";
-
-        // Check if password is empty
-        if (password.isEmpty()) {
-            Toast.makeText(this, "Vui lòng nhập mật khẩu", Toast.LENGTH_SHORT).show();
-            return false;
-        }
+        edtConfirmPassword.setOnFocusChangeListener((v, hasFocus) -> {
+            if (!hasFocus) {
+                validateConfirmPassword(true);
+            }
+        });
 
-        // Check password length
-        if (password.length() < 8) {
-            Toast.makeText(this, "Mật khẩu phải có ít nhất 8 ký tự", Toast.LENGTH_SHORT).show();
-            return false;
-        }
-
-        // Check for uppercase
-        if (!Pattern.compile("[A-Z]").matcher(password).find()) {
-            Toast.makeText(this, "Mật khẩu phải có ít nhất 1 chữ hoa", Toast.LENGTH_SHORT).show();
-            return false;
-        }
+        btnCreateAccount.setOnClickListener(v -> {
+            if (validateInputFinal()) {
+                performRegistration();
+            }
+        });
+    }
 
-        // Check for lowercase
-        if (!Pattern.compile("[a-z]").matcher(password).find()) {
-            Toast.makeText(this, "Mật khẩu phải có ít nhất 1 chữ thường", Toast.LENGTH_SHORT).show();
-            return false;
-        }
+    private void validatePasswordRealtime(String password) {
+        // 1. Kiểm tra độ dài >= 8
+        boolean isLengthOk = password.length() >= 8;
+        updateRuleStatus(tvRuleLength, isLengthOk);
+
+        // 2. Kiểm tra Hoa + Thường
+        boolean hasUpper = Pattern.compile("[A-Z]").matcher(password).find();
+        boolean hasLower = Pattern.compile("[a-z]").matcher(password).find();
+        updateRuleStatus(tvRuleUpperLower, hasUpper && hasLower);
+
+        // 3. Kiểm tra Số
+        boolean hasDigit = Pattern.compile("[0-9]").matcher(password).find();
+        updateRuleStatus(tvRuleDigit, hasDigit);
+
+        // 4. Kiểm tra Ký tự đặc biệt (!@#$)
+        boolean hasSpecial = Pattern.compile(SPECIAL_CHARACTERS_REGEX).matcher(password).find();
+        updateRuleStatus(tvRuleSpecial, hasSpecial);
+    }
 
-        // Check for digit
-        if (!Pattern.compile("[0-9]").matcher(password).find()) {
-            Toast.makeText(this, "Mật khẩu phải có ít nhất 1 chữ số", Toast.LENGTH_SHORT).show();
-            return false;
+    // Hàm phụ trợ để đổi màu TextView
+    private void updateRuleStatus(TextView tv, boolean isValid) {
+        if (isValid) {
+            tv.setTextColor(COLOR_SUCCESS);
+            tv.setCompoundDrawablesWithIntrinsicBounds(R.drawable.ic_check_green, 0, 0, 0);
+        } else {
+            tv.setTextColor(COLOR_DEFAULT);
+            tv.setCompoundDrawablesWithIntrinsicBounds(0, 0, 0, 0);
         }
+    }
 
-        // Check for special character
-        if (!Pattern.compile("[!@#$]").matcher(password).find()) {
-            Toast.makeText(this, "Mật khẩu phải có ít nhất 1 ký tự đặc biệt (!@#$)", Toast.LENGTH_SHORT).show();
+    private boolean validatePassword(boolean showError) {
+        String password = edtPassword.getText().toString();
+
+        boolean hasUpper = Pattern.compile("[A-Z]").matcher(password).find();
+        boolean hasLower = Pattern.compile("[a-z]").matcher(password).find();
+        boolean hasDigit = Pattern.compile("[0-9]").matcher(password).find();
+        boolean hasSpecial = Pattern.compile(SPECIAL_CHARACTERS_REGEX).matcher(password).find();
+
+        if (password.length() < 8 || !hasUpper || !hasLower || !hasDigit || !hasSpecial) {
+            edtPassword.setError("Mật khẩu chưa đúng quy tắc");
             return false;
         }
 
-        // Check if passwords match
+        edtPassword.setError(null);
+        return true;
+    }
+
+    private boolean validateConfirmPassword(boolean showError) {
+        String password = edtPassword.getText().toString();
+        String confirmPassword = edtConfirmPassword.getText().toString();
+
         if (!password.equals(confirmPassword)) {
-            Toast.makeText(this, "Mật khẩu xác nhận không khớp", Toast.LENGTH_SHORT).show();
+            if (showError) edtConfirmPassword.setError("Mật khẩu xác nhận không khớp");
             return false;
         }
 
+        edtConfirmPassword.setError(null);
         return true;
     }
-}
+
+    // --- LOGIC KIỂM TRA CUỐI CÙNG (KHI BẤM NÚT) ---
+    private boolean validateInputFinal() {
+        boolean p = validatePassword(false);
+        boolean cp = validateConfirmPassword(false);
+
+        return p && cp;
+    }
+
+    private void performRegistration() {
+        // 1. Lưu mật khẩu vào ViewModel
+        viewModel.saveAccountInfo(edtPassword.getText().toString());
+
+        // 2. Gọi hàm đăng ký
+        viewModel.registerUser();
+    }
+
+    @Override
+    public boolean dispatchTouchEvent(MotionEvent event) {
+        if (event.getAction() == MotionEvent.ACTION_DOWN) {
+            View v = getCurrentFocus();
+            if (v instanceof EditText) {
+                Rect outRect = new Rect();
+                v.getGlobalVisibleRect(outRect);
+                if (!outRect.contains((int)event.getRawX(), (int)event.getRawY())) {
+                    v.clearFocus();
+                    InputMethodManager imm = (InputMethodManager) getSystemService(Context.INPUT_METHOD_SERVICE);
+                    if (imm != null) imm.hideSoftInputFromWindow(v.getWindowToken(), 0);
+                }
+            }
+        }
+        return super.dispatchTouchEvent(event);
+    }
+}
\ No newline at end of file
Index: app/src/main/java/com/example/vibebank/ui/register/Register4Activity.java
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+>package com.example.vibebank.ui.register;\r\n\r\nimport android.annotation.SuppressLint;\r\nimport android.content.Intent;\r\nimport android.os.Bundle;\r\nimport android.util.Log;\r\nimport android.view.View;\r\nimport android.widget.AutoCompleteTextView;\r\nimport android.widget.ImageView;\r\nimport android.widget.Toast;\r\n\r\nimport androidx.activity.EdgeToEdge;\r\nimport androidx.appcompat.app.AppCompatActivity;\r\nimport androidx.core.graphics.Insets;\r\nimport androidx.core.view.ViewCompat;\r\nimport androidx.core.view.WindowInsetsCompat;\r\n\r\nimport com.example.vibebank.R;\r\nimport com.google.android.material.button.MaterialButton;\r\nimport com.google.android.material.textfield.TextInputEditText;\r\n\r\npublic class Register4Activity extends AppCompatActivity {\r\n    private static final String TAG = \"Register4Activity\";\r\n\r\n    private ImageView btnBack;\r\n    private MaterialButton btnNext;\r\n    private TextInputEditText edtFullName;\r\n    private TextInputEditText edtBirthDate;\r\n    private AutoCompleteTextView edtGender;\r\n    private TextInputEditText edtCCCD;\r\n    private TextInputEditText edtAddress;\r\n    private TextInputEditText edtIssueDate;\r\n    private TextInputEditText edtPhone;\r\n\r\n    @SuppressLint(\"MissingInflatedId\")\r\n    @Override\r\n    protected void onCreate(Bundle savedInstanceState) {\r\n        super.onCreate(savedInstanceState);\r\n        EdgeToEdge.enable(this);\r\n        setContentView(R.layout.activity_register4);\r\n\r\n        ViewCompat.setOnApplyWindowInsetsListener(findViewById(R.id.register4), (v, insets) -> {\r\n            Insets systemBars = insets.getInsets(WindowInsetsCompat.Type.systemBars());\r\n            v.setPadding(systemBars.left, systemBars.top, systemBars.right, systemBars.bottom);\r\n            return insets;\r\n        });\r\n\r\n        btnBack = findViewById(R.id.btnBack);\r\n        btnNext = findViewById(R.id.btnNext);\r\n        edtFullName = findViewById(R.id.edtFullName);\r\n        edtBirthDate = findViewById(R.id.edtBirthDate);\r\n        edtGender = findViewById(R.id.edtGender);\r\n        edtCCCD = findViewById(R.id.edtCCCD);\r\n        edtAddress = findViewById(R.id.edtAddress);\r\n        edtIssueDate = findViewById(R.id.edtIssueDate);\r\n        edtPhone = findViewById(R.id.edtPhone);\r\n\r\n        // Load data from previous screens\r\n        loadDataFromIntent();\r\n\r\n        btnBack.setOnClickListener(new View.OnClickListener() {\r\n            @Override\r\n            public void onClick(View v) {\r\n                finish();\r\n            }\r\n        });\r\n\r\n        btnNext.setOnClickListener(new View.OnClickListener() {\r\n            @Override\r\n            public void onClick(View v) {\r\n                try {\r\n                    Intent intent = new Intent(Register4Activity.this, Register5Activity.class);\r\n                    // Pass phone number to Register5\r\n                    String phone = getIntent().getStringExtra(\"phone\");\r\n                    intent.putExtra(\"phone\", phone != null ? phone : \"\");\r\n                    startActivity(intent);\r\n                } catch (Exception e) {\r\n                    Toast.makeText(Register4Activity.this, \"Có lỗi xảy ra: \" + e.getMessage(), Toast.LENGTH_SHORT).show();\r\n                    e.printStackTrace();\r\n                }\r\n            }\r\n        });\r\n    }\r\n\r\n    private void loadDataFromIntent() {\r\n        try {\r\n            Log.d(TAG, \"Starting to load data from intent\");\r\n            \r\n            // Get data from previous screens with default empty string\r\n            String cccd = getIntent().getStringExtra(\"cccd\");\r\n            String phone = getIntent().getStringExtra(\"phone\");\r\n            String email = getIntent().getStringExtra(\"email\");\r\n            String fullName = getIntent().getStringExtra(\"fullName\");\r\n            String birthDate = getIntent().getStringExtra(\"birthDate\");\r\n            String gender = getIntent().getStringExtra(\"gender\");\r\n            String address = getIntent().getStringExtra(\"address\");\r\n            String issueDate = getIntent().getStringExtra(\"issueDate\");\r\n            \r\n            Log.d(TAG, \"Data received - Name: \" + fullName + \", CCCD: \" + cccd + \", Phone: \" + phone);\r\n\r\n            // Display data safely\r\n            Log.d(TAG, \"Setting text to fields\");\r\n            if (edtFullName != null) edtFullName.setText(fullName != null && !fullName.isEmpty() ? fullName : \"\");\r\n            if (edtBirthDate != null) edtBirthDate.setText(birthDate != null && !birthDate.isEmpty() ? birthDate : \"\");\r\n            if (edtGender != null) edtGender.setText(gender != null && !gender.isEmpty() ? gender : \"\");\r\n            if (edtCCCD != null) edtCCCD.setText(cccd != null && !cccd.isEmpty() ? cccd : \"\");\r\n            if (edtAddress != null) edtAddress.setText(address != null && !address.isEmpty() ? address : \"\");\r\n            if (edtIssueDate != null) edtIssueDate.setText(issueDate != null && !issueDate.isEmpty() ? issueDate : \"\");\r\n            if (edtPhone != null) edtPhone.setText(phone != null && !phone.isEmpty() ? phone : \"\");\r\n            Log.d(TAG, \"Data loaded successfully\");\r\n        } catch (Exception e) {\r\n            Toast.makeText(this, \"Có lỗi khi tải dữ liệu: \" + e.getMessage(), Toast.LENGTH_SHORT).show();\r\n            e.printStackTrace();\r\n        }\r\n    }\r\n}\r\n
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/app/src/main/java/com/example/vibebank/ui/register/Register4Activity.java b/app/src/main/java/com/example/vibebank/ui/register/Register4Activity.java
--- a/app/src/main/java/com/example/vibebank/ui/register/Register4Activity.java	(revision 258f67465d9c97da1d54ee045196060b3376b7fb)
+++ b/app/src/main/java/com/example/vibebank/ui/register/Register4Activity.java	(date 1766051742939)
@@ -1,52 +1,41 @@
 package com.example.vibebank.ui.register;
 
-import android.annotation.SuppressLint;
 import android.content.Intent;
 import android.os.Bundle;
-import android.util.Log;
-import android.view.View;
 import android.widget.AutoCompleteTextView;
 import android.widget.ImageView;
-import android.widget.Toast;
-
-import androidx.activity.EdgeToEdge;
 import androidx.appcompat.app.AppCompatActivity;
-import androidx.core.graphics.Insets;
-import androidx.core.view.ViewCompat;
-import androidx.core.view.WindowInsetsCompat;
+import androidx.lifecycle.ViewModelProvider;
 
 import com.example.vibebank.R;
 import com.google.android.material.button.MaterialButton;
 import com.google.android.material.textfield.TextInputEditText;
 
 public class Register4Activity extends AppCompatActivity {
-    private static final String TAG = "Register4Activity";
 
     private ImageView btnBack;
     private MaterialButton btnNext;
-    private TextInputEditText edtFullName;
-    private TextInputEditText edtBirthDate;
+    private TextInputEditText edtFullName, edtBirthDate, edtCCCD, edtAddress, edtIssueDate, edtPhone;
     private AutoCompleteTextView edtGender;
-    private TextInputEditText edtCCCD;
-    private TextInputEditText edtAddress;
-    private TextInputEditText edtIssueDate;
-    private TextInputEditText edtPhone;
 
-    @SuppressLint("MissingInflatedId")
+    private RegisterViewModel viewModel;
+
     @Override
     protected void onCreate(Bundle savedInstanceState) {
         super.onCreate(savedInstanceState);
-        EdgeToEdge.enable(this);
         setContentView(R.layout.activity_register4);
 
-        ViewCompat.setOnApplyWindowInsetsListener(findViewById(R.id.register4), (v, insets) -> {
-            Insets systemBars = insets.getInsets(WindowInsetsCompat.Type.systemBars());
-            v.setPadding(systemBars.left, systemBars.top, systemBars.right, systemBars.bottom);
-            return insets;
-        });
+        viewModel = new ViewModelProvider(this).get(RegisterViewModel.class);
 
+        initViews();
+        loadDataFromViewModel();
+        setupListeners();
+    }
+
+    private void initViews() {
         btnBack = findViewById(R.id.btnBack);
         btnNext = findViewById(R.id.btnNext);
+
         edtFullName = findViewById(R.id.edtFullName);
         edtBirthDate = findViewById(R.id.edtBirthDate);
         edtGender = findViewById(R.id.edtGender);
@@ -54,63 +43,25 @@
         edtAddress = findViewById(R.id.edtAddress);
         edtIssueDate = findViewById(R.id.edtIssueDate);
         edtPhone = findViewById(R.id.edtPhone);
+    }
 
-        // Load data from previous screens
-        loadDataFromIntent();
+    private void loadDataFromViewModel() {
+        // Lấy dữ liệu hiển thị lên (Chỉ để xem)
+        edtFullName.setText(viewModel.getFullName());
+        edtBirthDate.setText(viewModel.getBirthDate());
+        edtGender.setText(viewModel.getGender());
+        edtCCCD.setText(viewModel.getCccd());
+        edtAddress.setText(viewModel.getAddress());
+        edtIssueDate.setText(viewModel.getIssueDate());
+        edtPhone.setText(viewModel.getPhone());
+    }
 
-        btnBack.setOnClickListener(new View.OnClickListener() {
-            @Override
-            public void onClick(View v) {
-                finish();
-            }
-        });
+    private void setupListeners() {
+        btnBack.setOnClickListener(v -> finish());
 
-        btnNext.setOnClickListener(new View.OnClickListener() {
-            @Override
-            public void onClick(View v) {
-                try {
-                    Intent intent = new Intent(Register4Activity.this, Register5Activity.class);
-                    // Pass phone number to Register5
-                    String phone = getIntent().getStringExtra("phone");
-                    intent.putExtra("phone", phone != null ? phone : "");
-                    startActivity(intent);
-                } catch (Exception e) {
-                    Toast.makeText(Register4Activity.this, "Có lỗi xảy ra: " + e.getMessage(), Toast.LENGTH_SHORT).show();
-                    e.printStackTrace();
-                }
-            }
+        btnNext.setOnClickListener(v -> {
+            Intent intent = new Intent(Register4Activity.this, Register5Activity.class);
+            startActivity(intent);
         });
     }
-
-    private void loadDataFromIntent() {
-        try {
-            Log.d(TAG, "Starting to load data from intent");
-            
-            // Get data from previous screens with default empty string
-            String cccd = getIntent().getStringExtra("cccd");
-            String phone = getIntent().getStringExtra("phone");
-            String email = getIntent().getStringExtra("email");
-            String fullName = getIntent().getStringExtra("fullName");
-            String birthDate = getIntent().getStringExtra("birthDate");
-            String gender = getIntent().getStringExtra("gender");
-            String address = getIntent().getStringExtra("address");
-            String issueDate = getIntent().getStringExtra("issueDate");
-            
-            Log.d(TAG, "Data received - Name: " + fullName + ", CCCD: " + cccd + ", Phone: " + phone);
-
-            // Display data safely
-            Log.d(TAG, "Setting text to fields");
-            if (edtFullName != null) edtFullName.setText(fullName != null && !fullName.isEmpty() ? fullName : "");
-            if (edtBirthDate != null) edtBirthDate.setText(birthDate != null && !birthDate.isEmpty() ? birthDate : "");
-            if (edtGender != null) edtGender.setText(gender != null && !gender.isEmpty() ? gender : "");
-            if (edtCCCD != null) edtCCCD.setText(cccd != null && !cccd.isEmpty() ? cccd : "");
-            if (edtAddress != null) edtAddress.setText(address != null && !address.isEmpty() ? address : "");
-            if (edtIssueDate != null) edtIssueDate.setText(issueDate != null && !issueDate.isEmpty() ? issueDate : "");
-            if (edtPhone != null) edtPhone.setText(phone != null && !phone.isEmpty() ? phone : "");
-            Log.d(TAG, "Data loaded successfully");
-        } catch (Exception e) {
-            Toast.makeText(this, "Có lỗi khi tải dữ liệu: " + e.getMessage(), Toast.LENGTH_SHORT).show();
-            e.printStackTrace();
-        }
-    }
-}
+}
\ No newline at end of file
Index: app/src/main/java/com/example/vibebank/ui/register/RegisterActivity.java
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+>package com.example.vibebank.ui.register;\r\n\r\nimport android.content.Context;\r\nimport android.content.Intent;\r\nimport android.graphics.Rect;\r\nimport android.os.Bundle;\r\nimport android.util.Log;\r\nimport android.util.Patterns;\r\nimport android.view.MotionEvent;\r\nimport android.view.View;\r\nimport android.view.inputmethod.InputMethodManager;\r\nimport android.widget.EditText;\r\nimport android.widget.Toast;\r\nimport androidx.annotation.NonNull;\r\nimport androidx.appcompat.app.AlertDialog;\r\nimport androidx.appcompat.app.AppCompatActivity;\r\nimport androidx.lifecycle.ViewModelProvider;\r\n\r\nimport com.example.vibebank.R;\r\nimport com.google.android.material.button.MaterialButton;\r\nimport com.google.android.material.textfield.TextInputEditText;\r\nimport com.google.firebase.FirebaseException;\r\nimport com.google.firebase.auth.FirebaseAuth;\r\nimport com.google.firebase.auth.PhoneAuthCredential;\r\nimport com.google.firebase.auth.PhoneAuthOptions;\r\nimport com.google.firebase.auth.PhoneAuthProvider;\r\n\r\nimport java.util.concurrent.TimeUnit;\r\n\r\npublic class RegisterActivity extends AppCompatActivity {\r\n    private MaterialButton btnNext;\r\n    private TextInputEditText edtCCCD, edtPhone, edtEmail;\r\n    private FirebaseAuth mAuth;\r\n    private String mVerificationId;\r\n    private PhoneAuthProvider.ForceResendingToken mResendToken;\r\n    private RegisterViewModel viewModel;\r\n\r\n    @Override\r\n    protected void onCreate(Bundle savedInstanceState) {\r\n        super.onCreate(savedInstanceState);\r\n        setContentView(R.layout.activity_register);\r\n\r\n        mAuth = FirebaseAuth.getInstance();\r\n        viewModel = new ViewModelProvider(this).get(RegisterViewModel.class);\r\n\r\n        btnNext = findViewById(R.id.btnNext);\r\n        edtCCCD = findViewById(R.id.edtCCCD);\r\n        edtPhone = findViewById(R.id.edtPhone);\r\n        edtEmail = findViewById(R.id.edtEmail);\r\n\r\n        findViewById(R.id.btnBack).setOnClickListener(v -> finish());\r\n\r\n        btnNext.setOnClickListener(v -> {\r\n            if (validateInputs()) {\r\n                String phoneRaw = edtPhone.getText().toString().trim();\r\n                String phoneFormatted = phoneRaw.startsWith(\"0\") ? \"+84\" + phoneRaw.substring(1) : phoneRaw;\r\n                sendSmsOtp(phoneFormatted);\r\n            }\r\n        });\r\n    }\r\n\r\n    private boolean validateInputs() {\r\n        String cccd = edtCCCD.getText().toString().trim();\r\n        String phone = edtPhone.getText().toString().trim();\r\n        String email = edtEmail.getText().toString().trim();\r\n\r\n        if (cccd.isEmpty() || !cccd.matches(\"^\\\\d{12}$\")) {\r\n            edtCCCD.setError(\"CCCD phải đủ 12 số\"); return false;\r\n        }\r\n        if (phone.isEmpty() || !phone.matches(\"^0\\\\d{9}$\")) {\r\n            edtPhone.setError(\"Số điện thoại không hợp lệ (10 số)\"); return false;\r\n        }\r\n        if (email.isEmpty() || !Patterns.EMAIL_ADDRESS.matcher(email).matches()) {\r\n            edtEmail.setError(\"Email không đúng định dạng\"); return false;\r\n        }\r\n        return true;\r\n    }\r\n\r\n    private void sendSmsOtp(String phoneNumber) {\r\n        btnNext.setEnabled(false);\r\n        btnNext.setText(\"Đang gửi OTP...\");\r\n\r\n        PhoneAuthOptions options = PhoneAuthOptions.newBuilder(mAuth)\r\n                .setPhoneNumber(phoneNumber)\r\n                .setTimeout(60L, TimeUnit.SECONDS)\r\n                .setActivity(this)\r\n                .setCallbacks(mCallbacks)\r\n                .build();\r\n        PhoneAuthProvider.verifyPhoneNumber(options);\r\n    }\r\n\r\n    private final PhoneAuthProvider.OnVerificationStateChangedCallbacks mCallbacks =\r\n            new PhoneAuthProvider.OnVerificationStateChangedCallbacks() {\r\n                @Override\r\n                public void onVerificationCompleted(@NonNull PhoneAuthCredential credential) {\r\n                    // Tự động verify thành công (tùy chọn)\r\n                }\r\n\r\n                @Override\r\n                public void onVerificationFailed(@NonNull FirebaseException e) {\r\n                    btnNext.setEnabled(true);\r\n                    btnNext.setText(\"Tiếp tục\");\r\n                    showErrorDialog(e.getMessage());\r\n                }\r\n\r\n                @Override\r\n                public void onCodeSent(@NonNull String verificationId, @NonNull PhoneAuthProvider.ForceResendingToken token) {\r\n                    btnNext.setEnabled(true);\r\n                    btnNext.setText(\"Tiếp tục\");\r\n                    mVerificationId = verificationId;\r\n                    mResendToken = token;\r\n                    showOtpDialog();\r\n                }\r\n            };\r\n\r\n    private void showOtpDialog() {\r\n        OtpBottomSheetDialog otpDialog = OtpBottomSheetDialog.newInstance(mVerificationId);\r\n        otpDialog.setOtpVerificationListener(new OtpBottomSheetDialog.OtpVerificationListener() {\r\n            @Override\r\n            public void onOtpVerified(String otp) {\r\n                verifyCode(otp);\r\n            }\r\n            @Override\r\n            public void onResendOtp() {\r\n                String phone = edtPhone.getText().toString().trim();\r\n                sendSmsOtp(phone.startsWith(\"0\") ? \"+84\" + phone.substring(1) : phone);\r\n            }\r\n        });\r\n        otpDialog.show(getSupportFragmentManager(), \"OtpBottomSheet\");\r\n    }\r\n\r\n    private void verifyCode(String code) {\r\n        if (mVerificationId == null) return;\r\n        PhoneAuthCredential credential = PhoneAuthProvider.getCredential(mVerificationId, code);\r\n        mAuth.signInWithCredential(credential).addOnCompleteListener(this, task -> {\r\n            if (task.isSuccessful()) {\r\n                // LƯU DỮ LIỆU VÀO VIEWMODEL\r\n                viewModel.saveStep1(\r\n                        edtEmail.getText().toString(),\r\n                        edtPhone.getText().toString(),\r\n                        edtCCCD.getText().toString()\r\n                );\r\n\r\n                Intent intent = new Intent(RegisterActivity.this, Register2Activity.class);\r\n                startActivity(intent);\r\n            } else {\r\n                Toast.makeText(RegisterActivity.this, \"Mã OTP không đúng\", Toast.LENGTH_SHORT).show();\r\n            }\r\n        });\r\n    }\r\n\r\n    private void showErrorDialog(String msg) {\r\n        new AlertDialog.Builder(this).setTitle(\"Lỗi\").setMessage(msg).setPositiveButton(\"OK\", null).show();\r\n    }\r\n\r\n    @Override\r\n    public boolean dispatchTouchEvent(MotionEvent event) {\r\n        if (event.getAction() == MotionEvent.ACTION_DOWN) {\r\n            View v = getCurrentFocus();\r\n            if (v instanceof EditText) {\r\n                Rect outRect = new Rect();\r\n                v.getGlobalVisibleRect(outRect);\r\n                if (!outRect.contains((int)event.getRawX(), (int)event.getRawY())) {\r\n                    v.clearFocus();\r\n                    InputMethodManager imm = (InputMethodManager) getSystemService(Context.INPUT_METHOD_SERVICE);\r\n                    if (imm != null) imm.hideSoftInputFromWindow(v.getWindowToken(), 0);\r\n                }\r\n            }\r\n        }\r\n        return super.dispatchTouchEvent(event);\r\n    }\r\n}
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/app/src/main/java/com/example/vibebank/ui/register/RegisterActivity.java b/app/src/main/java/com/example/vibebank/ui/register/RegisterActivity.java
--- a/app/src/main/java/com/example/vibebank/ui/register/RegisterActivity.java	(revision 258f67465d9c97da1d54ee045196060b3376b7fb)
+++ b/app/src/main/java/com/example/vibebank/ui/register/RegisterActivity.java	(date 1766126453798)
@@ -4,7 +4,6 @@
 import android.content.Intent;
 import android.graphics.Rect;
 import android.os.Bundle;
-import android.util.Log;
 import android.util.Patterns;
 import android.view.MotionEvent;
 import android.view.View;
@@ -17,6 +16,7 @@
 import androidx.lifecycle.ViewModelProvider;
 
 import com.example.vibebank.R;
+import com.example.vibebank.ui.OtpBottomSheetDialog;
 import com.google.android.material.button.MaterialButton;
 import com.google.android.material.textfield.TextInputEditText;
 import com.google.firebase.FirebaseException;
@@ -43,39 +43,142 @@
         mAuth = FirebaseAuth.getInstance();
         viewModel = new ViewModelProvider(this).get(RegisterViewModel.class);
 
+        initViews();
+        setupRealtimeCheck();
+        setupObservers();
+
+        findViewById(R.id.btnBack).setOnClickListener(v -> finish());
+
+        btnNext.setOnClickListener(v -> {
+//            if (validateInputs()) {
+//                String phoneRaw = edtPhone.getText().toString().trim();
+//                String phoneFormatted = phoneRaw.startsWith("0") ? "+84" + phoneRaw.substring(1) : phoneRaw;
+//                sendSmsOtp(phoneFormatted);
+//            }
+            if (validateInputs()) {
+                String email = edtEmail.getText().toString().trim();
+                String phone = edtPhone.getText().toString().trim();
+                String cccd = edtCCCD.getText().toString().trim();
+
+                viewModel.performFinalCheck(email, phone, cccd);
+            }
+        });
+    }
+
+    private void initViews() {
         btnNext = findViewById(R.id.btnNext);
         edtCCCD = findViewById(R.id.edtCCCD);
         edtPhone = findViewById(R.id.edtPhone);
         edtEmail = findViewById(R.id.edtEmail);
+    }
+
+    // 1. LẮNG NGHE SỰ KIỆN MẤT FOCUS ĐỂ CHECK
+    private void setupRealtimeCheck() {
+        edtEmail.setOnFocusChangeListener((v, hasFocus) -> {
+            if (!hasFocus) {
+                String email = edtEmail.getText().toString().trim();
+                if (validateEmailFormat(email)) {
+                    viewModel.checkEmailExistence(email);
+                }
+            }
+        });
+
+        edtCCCD.setOnFocusChangeListener((v, hasFocus) -> {
+            if (!hasFocus) {
+                String cccd = edtCCCD.getText().toString().trim();
+                if (validateCccdFormat(cccd)) {
+                    viewModel.checkCccdExistence(cccd);
+                }
+            }
+        });
+
+        edtPhone.setOnFocusChangeListener((v, hasFocus) -> {
+            if (!hasFocus) {
+                String phone = edtPhone.getText().toString().trim();
+                if (validatePhoneFormat(phone)) {
+                    viewModel.checkPhoneExistence(phone);
+                }
+            }
+        });
+    }
+
+    // 2. NHẬN KẾT QUẢ TỪ SERVER VÀ HIỆN SET ERROR
+    private void setupObservers() {
+        viewModel.emailError.observe(this, errorMsg -> {
+            if (errorMsg != null) edtEmail.setError(errorMsg);
+            else edtEmail.setError(null);
+        });
 
-        findViewById(R.id.btnBack).setOnClickListener(v -> finish());
+        viewModel.cccdError.observe(this, errorMsg -> {
+            if (errorMsg != null) edtCCCD.setError(errorMsg);
+            else edtCCCD.setError(null);
+        });
 
-        btnNext.setOnClickListener(v -> {
-            if (validateInputs()) {
+        viewModel.phoneError.observe(this, errorMsg -> {
+            if (errorMsg != null) edtPhone.setError(errorMsg);
+            else edtPhone.setError(null);
+        });
+
+        viewModel.finalCheckAction.observe(this, result -> {
+            if (result == null) return;
+
+            if (result.isSuccess) {
                 String phoneRaw = edtPhone.getText().toString().trim();
                 String phoneFormatted = phoneRaw.startsWith("0") ? "+84" + phoneRaw.substring(1) : phoneRaw;
                 sendSmsOtp(phoneFormatted);
+            } else {
+                if ("EMAIL".equals(result.errorField)) {
+                    edtEmail.setError(result.errorMsg);
+                    edtEmail.requestFocus();
+                } else if ("PHONE".equals(result.errorField)) {
+                    edtPhone.setError(result.errorMsg);
+                    edtPhone.requestFocus();
+                } else if ("CCCD".equals(result.errorField)) {
+                    edtCCCD.setError(result.errorMsg);
+                    edtCCCD.requestFocus();
+                }
             }
         });
+
+        // Lắng nghe trạng thái Loading để vô hiệu hóa nút Next
+        viewModel.isLoading.observe(this, isLoading -> {
+            btnNext.setEnabled(!isLoading);
+            btnNext.setText(isLoading ? "Đang kiểm tra..." : "Tiếp tục");
+        });
     }
 
-    private boolean validateInputs() {
-        String cccd = edtCCCD.getText().toString().trim();
-        String phone = edtPhone.getText().toString().trim();
-        String email = edtEmail.getText().toString().trim();
+    private boolean validateEmailFormat(String email) {
+        if (email.isEmpty() || !Patterns.EMAIL_ADDRESS.matcher(email).matches()) {
+            edtEmail.setError("Email sai định dạng");
+            return false;
+        }
+        return true;
+    }
 
+    private boolean validateCccdFormat(String cccd) {
         if (cccd.isEmpty() || !cccd.matches("^\\d{12}$")) {
-            edtCCCD.setError("CCCD phải đủ 12 số"); return false;
+            edtCCCD.setError("CCCD phải đủ 12 số");
+            return false;
         }
+        return true;
+    }
+
+    private boolean validatePhoneFormat(String phone) {
         if (phone.isEmpty() || !phone.matches("^0\\d{9}$")) {
-            edtPhone.setError("Số điện thoại không hợp lệ (10 số)"); return false;
-        }
-        if (email.isEmpty() || !Patterns.EMAIL_ADDRESS.matcher(email).matches()) {
-            edtEmail.setError("Email không đúng định dạng"); return false;
+            edtPhone.setError("Số điện thoại không hợp lệ (10 số)");
+            return false;
         }
         return true;
     }
 
+    private boolean validateInputs() {
+        boolean e = validateEmailFormat(edtEmail.getText().toString().trim());
+        boolean c = validateCccdFormat(edtCCCD.getText().toString().trim());
+        boolean p = validatePhoneFormat(edtPhone.getText().toString().trim());
+
+        return e && c && p;
+    }
+
     private void sendSmsOtp(String phoneNumber) {
         btnNext.setEnabled(false);
         btnNext.setText("Đang gửi OTP...");
Index: app/src/main/java/com/example/vibebank/ui/register/Register2Activity.java
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+>package com.example.vibebank.ui.register;\r\n\r\nimport android.app.DatePickerDialog;\r\nimport android.content.Context;\r\nimport android.content.Intent;\r\nimport android.graphics.Rect;\r\nimport android.os.Bundle;\r\nimport android.view.MotionEvent;\r\nimport android.view.View;\r\nimport android.view.inputmethod.InputMethodManager;\r\nimport android.widget.ArrayAdapter;\r\nimport android.widget.AutoCompleteTextView;\r\nimport android.widget.EditText;\r\nimport android.widget.Toast;\r\nimport androidx.appcompat.app.AppCompatActivity;\r\nimport androidx.lifecycle.ViewModelProvider;\r\n\r\nimport com.example.vibebank.R;\r\nimport com.google.android.material.button.MaterialButton;\r\nimport com.google.android.material.textfield.TextInputEditText;\r\n\r\nimport java.text.ParseException;\r\nimport java.text.SimpleDateFormat;\r\nimport java.util.Calendar;\r\nimport java.util.Date;\r\nimport java.util.Locale;\r\n\r\npublic class Register2Activity extends AppCompatActivity {\r\n    private MaterialButton btnNext;\r\n    private TextInputEditText edtFullName, edtBirthDate, edtIssueDate, edtAddress;\r\n    private AutoCompleteTextView edtGender;\r\n    private RegisterViewModel viewModel;\r\n    private final SimpleDateFormat dateFormat = new SimpleDateFormat(\"dd/MM/yyyy\", Locale.getDefault());\r\n\r\n    @Override\r\n    protected void onCreate(Bundle savedInstanceState) {\r\n        super.onCreate(savedInstanceState);\r\n        setContentView(R.layout.activity_register2);\r\n\r\n        viewModel = new ViewModelProvider(this).get(RegisterViewModel.class);\r\n        initViews();\r\n\r\n        findViewById(R.id.btnBack).setOnClickListener(v -> finish());\r\n        btnNext.setOnClickListener(v -> {\r\n            if (validateInputs()) {\r\n                // LƯU DỮ LIỆU BƯỚC 2 VÀO VIEWMODEL\r\n                viewModel.saveStep2(\r\n                        edtFullName.getText().toString(),\r\n                        edtBirthDate.getText().toString(),\r\n                        edtGender.getText().toString(),\r\n                        edtAddress.getText().toString(),\r\n                        edtIssueDate.getText().toString()\r\n                );\r\n\r\n                 Intent intent = new Intent(this, Register3Activity.class);\r\n                 startActivity(intent);\r\n            }\r\n        });\r\n    }\r\n\r\n    private void initViews() {\r\n        btnNext = findViewById(R.id.btnNext);\r\n        edtFullName = findViewById(R.id.edtFullName);\r\n        edtBirthDate = findViewById(R.id.edtBirthDate);\r\n        edtIssueDate = findViewById(R.id.edtIssueDate);\r\n        edtAddress = findViewById(R.id.edtAddress);\r\n        edtGender = findViewById(R.id.edtGender);\r\n\r\n        String[] genders = {\"Nam\", \"Nữ\"};\r\n        edtGender.setAdapter(new ArrayAdapter<>(this, android.R.layout.simple_dropdown_item_1line, genders));\r\n        edtGender.setKeyListener(null);\r\n\r\n        edtBirthDate.setKeyListener(null);\r\n        edtIssueDate.setKeyListener(null);\r\n\r\n        View.OnClickListener dateClick = v -> showDatePicker((TextInputEditText) v);\r\n        edtBirthDate.setOnClickListener(dateClick);\r\n        edtIssueDate.setOnClickListener(dateClick);\r\n\r\n        View.OnFocusChangeListener focusListener = (v, hasFocus) -> { if(hasFocus) showDatePicker((TextInputEditText)v); };\r\n        edtBirthDate.setOnFocusChangeListener(focusListener);\r\n        edtIssueDate.setOnFocusChangeListener(focusListener);\r\n    }\r\n\r\n    private boolean validateInputs() {\r\n        String name = edtFullName.getText().toString().trim();\r\n        String dob = edtBirthDate.getText().toString();\r\n        String gender = edtGender.getText().toString();\r\n        String address = edtAddress.getText().toString().trim();\r\n        String issue = edtIssueDate.getText().toString();\r\n\r\n        if (name.length() < 4) { edtFullName.setError(\"Họ tên quá ngắn\"); return false; }\r\n        if (gender.isEmpty()) { edtGender.setError(\"Chọn giới tính\"); return false; } else edtGender.setError(null);\r\n        if (address.isEmpty()) { edtAddress.setError(\"Nhập địa chỉ\"); return false; }\r\n\r\n        if (dob.isEmpty()) { edtBirthDate.setError(\"Chọn ngày sinh\"); return false; }\r\n        if (!isAdult(dob)) { edtBirthDate.setError(\"Phải đủ 18 tuổi\"); return false; } else edtBirthDate.setError(null);\r\n\r\n        if (issue.isEmpty()) { edtIssueDate.setError(\"Chọn ngày cấp\"); return false; }\r\n        if (!isValidIssueDate(issue, dob)) { edtIssueDate.setError(\"Ngày cấp không hợp lệ\"); return false; } else edtIssueDate.setError(null);\r\n\r\n        return true;\r\n    }\r\n\r\n    private boolean isAdult(String dateStr) {\r\n        try {\r\n            Calendar dob = Calendar.getInstance(); dob.setTime(dateFormat.parse(dateStr));\r\n            Calendar today = Calendar.getInstance();\r\n            int age = today.get(Calendar.YEAR) - dob.get(Calendar.YEAR);\r\n            if (today.get(Calendar.DAY_OF_YEAR) < dob.get(Calendar.DAY_OF_YEAR)) age--;\r\n            return age >= 18;\r\n        } catch (Exception e) { return false; }\r\n    }\r\n\r\n    private boolean isValidIssueDate(String issueStr, String dobStr) {\r\n        try {\r\n            Date issue = dateFormat.parse(issueStr);\r\n            Date dob = dateFormat.parse(dobStr);\r\n            Date today = new Date();\r\n            return !issue.after(today) && issue.after(dob);\r\n        } catch (Exception e) { return false; }\r\n    }\r\n\r\n    private void showDatePicker(TextInputEditText editText) {\r\n        InputMethodManager imm = (InputMethodManager) getSystemService(Context.INPUT_METHOD_SERVICE);\r\n        if (imm != null) imm.hideSoftInputFromWindow(editText.getWindowToken(), 0);\r\n\r\n        Calendar cal = Calendar.getInstance();\r\n        try { if(editText.getText().length() > 0) cal.setTime(dateFormat.parse(editText.getText().toString())); } catch (Exception e){}\r\n\r\n        DatePickerDialog dpd = new DatePickerDialog(this, (v, y, m, d) -> {\r\n            editText.setText(String.format(Locale.getDefault(), \"%02d/%02d/%d\", d, m+1, y));\r\n            editText.setError(null);\r\n        }, cal.get(Calendar.YEAR), cal.get(Calendar.MONTH), cal.get(Calendar.DAY_OF_MONTH));\r\n        dpd.getDatePicker().setMaxDate(System.currentTimeMillis());\r\n        dpd.show();\r\n    }\r\n\r\n    @Override\r\n    public boolean dispatchTouchEvent(MotionEvent event) {\r\n        if (event.getAction() == MotionEvent.ACTION_DOWN) {\r\n            View v = getCurrentFocus();\r\n            if (v instanceof EditText) {\r\n                Rect outRect = new Rect();\r\n                v.getGlobalVisibleRect(outRect);\r\n                if (!outRect.contains((int)event.getRawX(), (int)event.getRawY())) {\r\n                    v.clearFocus();\r\n                    InputMethodManager imm = (InputMethodManager) getSystemService(Context.INPUT_METHOD_SERVICE);\r\n                    if (imm != null) imm.hideSoftInputFromWindow(v.getWindowToken(), 0);\r\n                }\r\n            }\r\n        }\r\n        return super.dispatchTouchEvent(event);\r\n    }\r\n}
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/app/src/main/java/com/example/vibebank/ui/register/Register2Activity.java b/app/src/main/java/com/example/vibebank/ui/register/Register2Activity.java
--- a/app/src/main/java/com/example/vibebank/ui/register/Register2Activity.java	(revision 258f67465d9c97da1d54ee045196060b3376b7fb)
+++ b/app/src/main/java/com/example/vibebank/ui/register/Register2Activity.java	(date 1766115729934)
@@ -5,6 +5,7 @@
 import android.content.Intent;
 import android.graphics.Rect;
 import android.os.Bundle;
+import android.text.InputType;
 import android.view.MotionEvent;
 import android.view.View;
 import android.view.inputmethod.InputMethodManager;
@@ -24,6 +25,7 @@
 import java.util.Calendar;
 import java.util.Date;
 import java.util.Locale;
+import java.util.regex.Pattern;
 
 public class Register2Activity extends AppCompatActivity {
     private MaterialButton btnNext;
@@ -31,6 +33,8 @@
     private AutoCompleteTextView edtGender;
     private RegisterViewModel viewModel;
     private final SimpleDateFormat dateFormat = new SimpleDateFormat("dd/MM/yyyy", Locale.getDefault());
+    private static final Pattern NAME_PATTERN = Pattern.compile("^[\\p{L} .'-]+$");
+    private static final Pattern ADDRESS_PATTERN = Pattern.compile("^[\\p{L}0-9\\s,./-]+$");
 
     @Override
     protected void onCreate(Bundle savedInstanceState) {
@@ -66,9 +70,21 @@
         edtAddress = findViewById(R.id.edtAddress);
         edtGender = findViewById(R.id.edtGender);
 
+        edtFullName.setInputType(InputType.TYPE_CLASS_TEXT | InputType.TYPE_TEXT_FLAG_CAP_WORDS);
+        edtFullName.setOnFocusChangeListener((v, hasFocus) -> {
+            if (!hasFocus) {
+                validateName(true);
+            }
+        });
+
         String[] genders = {"Nam", "Nữ"};
         edtGender.setAdapter(new ArrayAdapter<>(this, android.R.layout.simple_dropdown_item_1line, genders));
         edtGender.setKeyListener(null);
+        edtGender.setOnFocusChangeListener((v, hasFocus) -> {
+            if (!hasFocus) {
+                validateGender(true);
+            }
+        });
 
         edtBirthDate.setKeyListener(null);
         edtIssueDate.setKeyListener(null);
@@ -80,28 +96,129 @@
         View.OnFocusChangeListener focusListener = (v, hasFocus) -> { if(hasFocus) showDatePicker((TextInputEditText)v); };
         edtBirthDate.setOnFocusChangeListener(focusListener);
         edtIssueDate.setOnFocusChangeListener(focusListener);
-    }
+
+        edtBirthDate.setOnFocusChangeListener((v, hasFocus) -> {
+            if (!hasFocus) {
+                validateBirthDate(true);
+            }
+        });
+
+        edtIssueDate.setOnFocusChangeListener((v, hasFocus) -> {
+            if (!hasFocus) {
+                validateIssueDate(true);
+            }
+        });
 
-    private boolean validateInputs() {
+        edtAddress.setOnFocusChangeListener((v, hasFocus) -> {
+            if (!hasFocus) {
+                validateAddress(true);
+            }
+        });
+    }
+
+    private boolean validateName(boolean showError) {
         String name = edtFullName.getText().toString().trim();
-        String dob = edtBirthDate.getText().toString();
+
+        if (name.isEmpty()) {
+            if (showError) edtFullName.setError("Vui lòng nhập họ và tên");
+            return false;
+        }
+
+        if (name.length() < 4) {
+            edtFullName.setError("Tên quá ngắn");
+            return false;
+        }
+
+        if (!name.contains(" ")) {
+            edtFullName.setError("Vui lòng nhập đầy đủ Họ và Tên");
+            return false;
+        }
+
+        if (!NAME_PATTERN.matcher(name).matches()) {
+            edtFullName.setError("Tên không được chứa số hoặc ký tự đặc biệt");
+            return false;
+        }
+
+        edtFullName.setError(null);
+        return true;
+    }
+
+    private boolean validateGender(boolean showError) {
         String gender = edtGender.getText().toString();
+        if (gender.isEmpty()) {
+            if (showError) edtGender.setError("Chọn giới tính");
+            return false;
+        }
+        edtGender.setError(null);
+        return true;
+    }
+
+    private boolean validateAddress(boolean showError) {
         String address = edtAddress.getText().toString().trim();
+
+        if (address.isEmpty()) {
+            if (showError) edtAddress.setError("Nhập địa chỉ");
+            return false;
+        }
+
+        if (address.length() < 10) {
+            edtAddress.setError("Địa chỉ quá ngắn. Vui lòng ghi rõ Số nhà, Đường, Phường/Xã...");
+            return false;
+        }
+
+        if (!ADDRESS_PATTERN.matcher(address).matches()) {
+            edtAddress.setError("Địa chỉ chứa ký tự không hợp lệ");
+            return false;
+        }
+
+        edtAddress.setError(null);
+        return true;
+    }
+
+    private boolean validateBirthDate(boolean showError) {
+        String dob = edtBirthDate.getText().toString();
+
+        if (dob.isEmpty()) {
+            if (showError) edtBirthDate.setError("Chọn ngày sinh");
+            return false;
+        }
+
+        if (!isAdult(dob)) {
+            edtBirthDate.setError("Phải đủ 18 tuổi");
+            return false;
+        }
+
+        edtBirthDate.setError(null);
+        return true;
+    }
+
+    private boolean validateIssueDate(boolean showError) {
         String issue = edtIssueDate.getText().toString();
 
-        if (name.length() < 4) { edtFullName.setError("Họ tên quá ngắn"); return false; }
-        if (gender.isEmpty()) { edtGender.setError("Chọn giới tính"); return false; } else edtGender.setError(null);
-        if (address.isEmpty()) { edtAddress.setError("Nhập địa chỉ"); return false; }
+        if (issue.isEmpty()) {
+            if (showError) edtIssueDate.setError("Chọn ngày cấp");
+            return false;
+        }
 
-        if (dob.isEmpty()) { edtBirthDate.setError("Chọn ngày sinh"); return false; }
-        if (!isAdult(dob)) { edtBirthDate.setError("Phải đủ 18 tuổi"); return false; } else edtBirthDate.setError(null);
+        if (!isValidIssueDate(issue, edtBirthDate.getText().toString())) {
+            edtIssueDate.setError("Ngày cấp không hợp lệ");
+            return false;
+        }
 
-        if (issue.isEmpty()) { edtIssueDate.setError("Chọn ngày cấp"); return false; }
-        if (!isValidIssueDate(issue, dob)) { edtIssueDate.setError("Ngày cấp không hợp lệ"); return false; } else edtIssueDate.setError(null);
-
+        edtIssueDate.setError(null);
         return true;
     }
 
+    private boolean validateInputs() {
+        boolean n = validateName(false);
+        boolean g = validateGender(false);
+        boolean a = validateAddress(false);
+        boolean b = validateBirthDate(false);
+        boolean i = validateIssueDate(false);
+
+        return n && g && a && b && i;
+    }
+
     private boolean isAdult(String dateStr) {
         try {
             Calendar dob = Calendar.getInstance(); dob.setTime(dateFormat.parse(dateStr));
Index: app/src/main/res/drawable/ic_check_green.xml
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/app/src/main/res/drawable/ic_check_green.xml b/app/src/main/res/drawable/ic_check_green.xml
new file mode 100644
--- /dev/null	(date 1766055290594)
+++ b/app/src/main/res/drawable/ic_check_green.xml	(date 1766055290594)
@@ -0,0 +1,5 @@
+<vector xmlns:android="http://schemas.android.com/apk/res/android" android:height="24dp" android:tint="#4CAF50" android:viewportHeight="960" android:viewportWidth="960" android:width="24dp">
+      
+    <path android:fillColor="@android:color/white" android:pathData="M400,656L240,496L296,440L400,544L664,280L720,336L400,656Z"/>
+    
+</vector>
Index: app/src/main/res/values/themes.xml
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+><resources xmlns:tools=\"http://schemas.android.com/tools\">\r\n    <!-- Base application theme. -->\r\n    <style name=\"Base.Theme.VibeBank\" parent=\"Theme.Material3.DayNight.NoActionBar\">\r\n        <!-- Customize your light theme here. -->\r\n        <!-- <item name=\"colorPrimary\">@color/my_light_primary</item> -->\r\n        <item name=\"android:fontFamily\">@font/nunito_sans</item>\r\n        <item name=\"fontFamily\">@font/nunito_sans</item>\r\n    </style>\r\n\r\n    <style name=\"Theme.VibeBank\" parent=\"Base.Theme.VibeBank\" />\r\n\r\n    <!-- OTP Digit Style -->\r\n    <style name=\"OtpDigitStyle\">\r\n        <item name=\"android:layout_width\">45dp</item>\r\n        <item name=\"android:layout_height\">45dp</item>\r\n        <item name=\"android:gravity\">center</item>\r\n        <item name=\"android:inputType\">number</item>\r\n        <item name=\"android:maxLength\">1</item>\r\n        <item name=\"android:textSize\">20sp</item>\r\n        <item name=\"android:textColor\">#000000</item>\r\n        <item name=\"android:fontFamily\">@font/nunito_sans</item>\r\n        <item name=\"android:background\">@drawable/otp_digit_background</item>\r\n        <item name=\"android:textCursorDrawable\">@drawable/cursor_black</item>\r\n    </style>\r\n\r\n</resources>
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/app/src/main/res/values/themes.xml b/app/src/main/res/values/themes.xml
--- a/app/src/main/res/values/themes.xml	(revision 258f67465d9c97da1d54ee045196060b3376b7fb)
+++ b/app/src/main/res/values/themes.xml	(date 1766061373728)
@@ -3,6 +3,11 @@
     <style name="Base.Theme.VibeBank" parent="Theme.Material3.DayNight.NoActionBar">
         <!-- Customize your light theme here. -->
         <!-- <item name="colorPrimary">@color/my_light_primary</item> -->
+        <item name="colorPrimary">#000000</item>
+        <item name="colorPrimaryVariant">#000000</item>
+        <item name="android:textColorHighlight">#33000000</item> <item name="android:statusBarColor">#FFFFFF</item>
+        <item name="android:windowLightStatusBar">true</item>
+
         <item name="android:fontFamily">@font/nunito_sans</item>
         <item name="fontFamily">@font/nunito_sans</item>
     </style>
Index: app/src/main/java/com/example/vibebank/data/manager/RegisterDataManager.java
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+>package com.example.vibebank.data.manager;\r\n\r\npublic class RegisterDataManager {\r\n    private static RegisterDataManager instance;\r\n\r\n    // Dữ liệu từ Register 1\r\n    private String email;\r\n    private String phone;\r\n    private String cccd;\r\n\r\n    // Dữ liệu từ Register 2\r\n    private String fullName;\r\n    private String birthDate;\r\n    private String gender;\r\n    private String address;\r\n    private String issueDate;\r\n\r\n    // Dữ liệu từ Register 3\r\n    private String frontIdCardPath;\r\n    private String backIdCardPath;\r\n\r\n\r\n    private RegisterDataManager() {}\r\n\r\n    public static synchronized RegisterDataManager getInstance() {\r\n        if (instance == null) {\r\n            instance = new RegisterDataManager();\r\n        }\r\n        return instance;\r\n    }\r\n\r\n    public void clearData() {\r\n        email = null; phone = null; cccd = null;\r\n        fullName = null; birthDate = null; gender = null;\r\n        address = null; issueDate = null;\r\n        frontIdCardPath = null; backIdCardPath = null;\r\n    }\r\n\r\n    // Getters & Setters\r\n    public String getEmail() { return email; }\r\n    public void setEmail(String email) { this.email = email; }\r\n\r\n    public String getPhone() { return phone; }\r\n    public void setPhone(String phone) { this.phone = phone; }\r\n\r\n    public String getCccd() { return cccd; }\r\n    public void setCccd(String cccd) { this.cccd = cccd; }\r\n\r\n    public String getFullName() { return fullName; }\r\n    public void setFullName(String fullName) { this.fullName = fullName; }\r\n\r\n    public String getBirthDate() { return birthDate; }\r\n    public void setBirthDate(String birthDate) { this.birthDate = birthDate; }\r\n\r\n    public String getGender() { return gender; }\r\n    public void setGender(String gender) { this.gender = gender; }\r\n\r\n    public String getAddress() { return address; }\r\n    public void setAddress(String address) { this.address = address; }\r\n\r\n    public String getIssueDate() { return issueDate; }\r\n    public void setIssueDate(String issueDate) { this.issueDate = issueDate; }\r\n\r\n    public String getFrontIdCardPath() { return frontIdCardPath; }\r\n    public void setFrontIdCardPath(String path) { this.frontIdCardPath = path; }\r\n\r\n    public String getBackIdCardPath() { return backIdCardPath; }\r\n    public void setBackIdCardPath(String path) { this.backIdCardPath = path; }\r\n\r\n}
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/app/src/main/java/com/example/vibebank/data/manager/RegisterDataManager.java b/app/src/main/java/com/example/vibebank/data/manager/RegisterDataManager.java
--- a/app/src/main/java/com/example/vibebank/data/manager/RegisterDataManager.java	(revision 258f67465d9c97da1d54ee045196060b3376b7fb)
+++ b/app/src/main/java/com/example/vibebank/data/manager/RegisterDataManager.java	(date 1766052517724)
@@ -19,6 +19,8 @@
     private String frontIdCardPath;
     private String backIdCardPath;
 
+    // Dữ liệu từ Register 5
+    private String password;
 
     private RegisterDataManager() {}
 
@@ -67,4 +69,9 @@
     public String getBackIdCardPath() { return backIdCardPath; }
     public void setBackIdCardPath(String path) { this.backIdCardPath = path; }
 
+    public String getPassword() { return password; }
+    public void setPassword(String password) { this.password = password; }
+
+    public String getUsername() { return phone; }
+    public void setUsername(String username) { this.phone = username; }
 }
\ No newline at end of file
Index: app/build.gradle.kts
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+>plugins {\r\n    alias(libs.plugins.android.application)\r\n    // Add the Google services Gradle plugin\r\n    id(\"com.google.gms.google-services\")\r\n}\r\n\r\nandroid {\r\n    namespace = \"com.example.vibebank\"\r\n    compileSdk = 36\r\n\r\n    defaultConfig {\r\n        applicationId = \"com.example.vibebank\"\r\n        minSdk = 24\r\n        targetSdk = 36\r\n        versionCode = 1\r\n        versionName = \"1.0\"\r\n\r\n        testInstrumentationRunner = \"androidx.test.runner.AndroidJUnitRunner\"\r\n    }\r\n\r\n    buildTypes {\r\n        release {\r\n            isMinifyEnabled = false\r\n            proguardFiles(\r\n                getDefaultProguardFile(\"proguard-android-optimize.txt\"),\r\n                \"proguard-rules.pro\"\r\n            )\r\n        }\r\n    }\r\n    compileOptions {\r\n        sourceCompatibility = JavaVersion.VERSION_11\r\n        targetCompatibility = JavaVersion.VERSION_11\r\n    }\r\n}\r\n\r\ndependencies {\r\n\r\n    implementation(libs.appcompat)\r\n    implementation(libs.material)\r\n    implementation(libs.activity)\r\n    implementation(libs.constraintlayout)\r\n    testImplementation(libs.junit)\r\n    androidTestImplementation(libs.ext.junit)\r\n    androidTestImplementation(libs.espresso.core)\r\n\r\n    // Import the Firebase BoM\r\n    implementation(platform(\"com.google.firebase:firebase-bom:34.3.0\"))\r\n\r\n    // TODO: Add the dependencies for Firebase products you want to use\r\n    // When using the BoM, don't specify versions in Firebase dependencies\r\n    implementation (\"com.google.firebase:firebase-auth\")\r\n    implementation(\"com.google.android.gms:play-services-auth:20.7.0\")\r\n    implementation(\"com.google.firebase:firebase-analytics\")\r\n    \r\n    // Google Maps\r\n    implementation(\"com.google.android.gms:play-services-maps:18.2.0\")\r\n    implementation(\"com.google.android.gms:play-services-location:21.1.0\")\r\n    \r\n    // Add the dependencies for any other desired Firebase products\r\n    // https://firebase.google.com/docs/android/setup#available-libraries\r\n\r\n    val cameraxVersion = \"1.3.1\"\r\n    implementation(\"androidx.camera:camera-core:$cameraxVersion\")\r\n    implementation(\"androidx.camera:camera-camera2:$cameraxVersion\")\r\n    implementation(\"androidx.camera:camera-lifecycle:$cameraxVersion\")\r\n    implementation(\"androidx.camera:camera-view:$cameraxVersion\")\r\n\r\n    implementation(\"androidx.lifecycle:lifecycle-viewmodel:2.7.0\")\r\n    implementation(\"androidx.lifecycle:lifecycle-livedata:2.7.0\")\r\n}
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/app/build.gradle.kts b/app/build.gradle.kts
--- a/app/build.gradle.kts	(revision 258f67465d9c97da1d54ee045196060b3376b7fb)
+++ b/app/build.gradle.kts	(date 1766062012761)
@@ -49,6 +49,7 @@
     // TODO: Add the dependencies for Firebase products you want to use
     // When using the BoM, don't specify versions in Firebase dependencies
     implementation ("com.google.firebase:firebase-auth")
+    implementation("com.google.firebase:firebase-firestore")
     implementation("com.google.android.gms:play-services-auth:20.7.0")
     implementation("com.google.firebase:firebase-analytics")
     
@@ -59,12 +60,17 @@
     // Add the dependencies for any other desired Firebase products
     // https://firebase.google.com/docs/android/setup#available-libraries
 
+    // Thư viện hỗ trợ camera
     val cameraxVersion = "1.3.1"
     implementation("androidx.camera:camera-core:$cameraxVersion")
     implementation("androidx.camera:camera-camera2:$cameraxVersion")
     implementation("androidx.camera:camera-lifecycle:$cameraxVersion")
     implementation("androidx.camera:camera-view:$cameraxVersion")
 
+    // Thư viện hỗ trợ các API mới nhất
     implementation("androidx.lifecycle:lifecycle-viewmodel:2.7.0")
     implementation("androidx.lifecycle:lifecycle-livedata:2.7.0")
+
+    // Thư viện mã hóa mật khẩu
+    implementation("org.mindrot:jbcrypt:0.4")
 }
\ No newline at end of file
Index: app/src/main/java/com/example/vibebank/ui/login/LoginViewModel.java
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/app/src/main/java/com/example/vibebank/ui/login/LoginViewModel.java b/app/src/main/java/com/example/vibebank/ui/login/LoginViewModel.java
new file mode 100644
--- /dev/null	(date 1766121166305)
+++ b/app/src/main/java/com/example/vibebank/ui/login/LoginViewModel.java	(date 1766121166305)
@@ -0,0 +1,66 @@
+package com.example.vibebank.ui.login;
+
+import android.util.Log;
+
+import androidx.lifecycle.MutableLiveData;
+import androidx.lifecycle.ViewModel;
+
+import com.example.vibebank.utils.PasswordUtils;
+import com.google.firebase.firestore.DocumentSnapshot;
+import com.google.firebase.firestore.FirebaseFirestore;
+
+public class LoginViewModel extends ViewModel {
+
+    // LiveData trả về kết quả: String = Lỗi (nếu có), null = Thành công
+    public MutableLiveData<String> loginResult = new MutableLiveData<>();
+    // LiveData trạng thái loading
+    public MutableLiveData<Boolean> isLoading = new MutableLiveData<>(false);
+
+    // Biến tạm để lưu thông tin user khi login thành công
+    public String successUserId = "";
+    public String successFullName = "";
+
+    public void login(String phone, String password) {
+        if (phone.isEmpty() || password.isEmpty()) {
+            loginResult.setValue("Vui lòng điền đầy đủ thông tin");
+            return;
+        }
+
+        isLoading.setValue(true);
+        FirebaseFirestore db = FirebaseFirestore.getInstance();
+
+        // 1. Tìm user trong Firestore theo số điện thoại
+        // Lưu ý: Ở bước đăng ký ta lưu field là "phone_number"
+        db.collection("users")
+                .whereEqualTo("phone_number", phone)
+                .get()
+                .addOnSuccessListener(querySnapshot -> {
+                    if (querySnapshot.isEmpty()) {
+                        isLoading.setValue(false);
+                        loginResult.setValue("Tên đăng nhập hoặc mật khẩu không đúng");
+                    } else {
+                        // 2. Lấy document user đầu tiên tìm thấy
+                        DocumentSnapshot userDoc = querySnapshot.getDocuments().get(0);
+                        String storedHash = userDoc.getString("password_hash");
+
+                        // 3. Kiểm tra mật khẩu bằng BCrypt
+                        if (storedHash != null && PasswordUtils.checkPassword(password, storedHash)) {
+                            // Mật khẩu đúng
+                            successUserId = userDoc.getId();
+                            successFullName = userDoc.getString("full_name");
+                            isLoading.setValue(false);
+                            loginResult.setValue(null); // null báo hiệu thành công
+                        } else {
+                            // Mật khẩu sai
+                            isLoading.setValue(false);
+                            loginResult.setValue("Tên đăng nhập hoặc mật khẩu không đúng");
+                        }
+                    }
+                })
+                .addOnFailureListener(e -> {
+                    isLoading.setValue(false);
+                    loginResult.setValue("Lỗi kết nối: " + e.getMessage());
+                    Log.e("Login", "Error: ", e);
+                });
+    }
+}
\ No newline at end of file
Index: app/src/main/res/values-night/themes.xml
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+><resources xmlns:tools=\"http://schemas.android.com/tools\">\r\n    <!-- Base application theme. -->\r\n    <style name=\"Base.Theme.VibeBank\" parent=\"Theme.Material3.DayNight.NoActionBar\">\r\n        <!-- Customize your dark theme here. -->\r\n        <!-- <item name=\"colorPrimary\">@color/my_dark_primary</item> -->\r\n    </style>\r\n</resources>
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/app/src/main/res/values-night/themes.xml b/app/src/main/res/values-night/themes.xml
--- a/app/src/main/res/values-night/themes.xml	(revision 258f67465d9c97da1d54ee045196060b3376b7fb)
+++ b/app/src/main/res/values-night/themes.xml	(date 1766061431122)
@@ -3,5 +3,11 @@
     <style name="Base.Theme.VibeBank" parent="Theme.Material3.DayNight.NoActionBar">
         <!-- Customize your dark theme here. -->
         <!-- <item name="colorPrimary">@color/my_dark_primary</item> -->
+
+        <item name="colorPrimary">#000000</item>
+        <item name="colorPrimaryVariant">#000000</item>
+        <item name="android:textColorHighlight">#33000000</item> <item name="android:statusBarColor">#FFFFFF</item>
+        <item name="android:windowLightStatusBar">true</item>
+
     </style>
 </resources>
\ No newline at end of file
Index: app/src/main/java/com/example/vibebank/utils/SessionManager.java
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/app/src/main/java/com/example/vibebank/utils/SessionManager.java b/app/src/main/java/com/example/vibebank/utils/SessionManager.java
new file mode 100644
--- /dev/null	(date 1766120569803)
+++ b/app/src/main/java/com/example/vibebank/utils/SessionManager.java	(date 1766120569803)
@@ -0,0 +1,49 @@
+package com.example.vibebank.utils;
+
+import android.content.Context;
+import android.content.SharedPreferences;
+
+public class SessionManager {
+    private static final String PREF_NAME = "VibeBankSession";
+    private static final String KEY_IS_LOGGED_IN = "isLoggedIn";
+    private static final String KEY_PHONE = "phone";
+    private static final String KEY_FULL_NAME = "fullName";
+    private static final String KEY_USER_ID = "userId";
+
+    private final SharedPreferences pref;
+    private final SharedPreferences.Editor editor;
+
+    public SessionManager(Context context) {
+        pref = context.getSharedPreferences(PREF_NAME, Context.MODE_PRIVATE);
+        editor = pref.edit();
+    }
+
+    // Lưu thông tin khi đăng nhập thành công
+    public void createLoginSession(String userId, String phone, String fullName) {
+        editor.putBoolean(KEY_IS_LOGGED_IN, true);
+        editor.putString(KEY_USER_ID, userId);
+        editor.putString(KEY_PHONE, phone);
+        editor.putString(KEY_FULL_NAME, fullName);
+        editor.apply();
+    }
+
+    // Kiểm tra xem user đã đăng nhập chưa
+    public boolean isLoggedIn() {
+        return pref.getBoolean(KEY_IS_LOGGED_IN, false);
+    }
+
+    // Lấy thông tin User
+    public String getFullName() {
+        return pref.getString(KEY_FULL_NAME, "User");
+    }
+
+    public String getPhone() {
+        return pref.getString(KEY_PHONE, "");
+    }
+
+    // Đăng xuất
+    public void logoutUser() {
+        editor.clear();
+        editor.commit();
+    }
+}
\ No newline at end of file
Index: app/src/main/java/com/example/vibebank/utils/PasswordUtils.java
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/app/src/main/java/com/example/vibebank/utils/PasswordUtils.java b/app/src/main/java/com/example/vibebank/utils/PasswordUtils.java
new file mode 100644
--- /dev/null	(date 1766062301847)
+++ b/app/src/main/java/com/example/vibebank/utils/PasswordUtils.java	(date 1766062301847)
@@ -0,0 +1,21 @@
+package com.example.vibebank.utils;
+
+import org.mindrot.jbcrypt.BCrypt;
+
+public class PasswordUtils {
+
+    // Hàm dùng khi Đăng ký (Tạo Hash từ mật khẩu nhập vào)
+    public static String hashPassword(String plainTextPassword) {
+        // gensalt() tạo ra một chuỗi ngẫu nhiên để mỗi lần hash đều khác nhau
+        // dù 2 người có mật khẩu giống hệt nhau
+        return BCrypt.hashpw(plainTextPassword, BCrypt.gensalt());
+    }
+
+    // Hàm dùng khi Đăng nhập (Kiểm tra mật khẩu nhập vào có khớp với Hash trong DB không)
+    public static boolean checkPassword(String candidatePassword, String storedHash) {
+        if (storedHash == null || !storedHash.startsWith("$2a$"))
+            return false;
+
+        return BCrypt.checkpw(candidatePassword, storedHash);
+    }
+}
\ No newline at end of file
Index: app/src/main/res/layout/activity_register5.xml
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+><?xml version=\"1.0\" encoding=\"utf-8\"?>\r\n<LinearLayout xmlns:android=\"http://schemas.android.com/apk/res/android\"\r\n    android:layout_width=\"match_parent\"\r\n    android:layout_height=\"match_parent\"\r\n    xmlns:app=\"http://schemas.android.com/apk/res-auto\"\r\n    android:orientation=\"vertical\"\r\n    android:background=\"#FFFFFF\"\r\n    android:id=\"@+id/register5\">\r\n\r\n    <!-- App Bar -->\r\n    <LinearLayout\r\n        android:id=\"@+id/appbar\"\r\n        android:layout_width=\"match_parent\"\r\n        android:layout_height=\"56dp\"\r\n        android:orientation=\"horizontal\"\r\n        android:gravity=\"center_vertical\"\r\n        android:paddingStart=\"16dp\"\r\n        android:paddingEnd=\"16dp\"\r\n        android:elevation=\"10dp\"\r\n        android:background=\"@color/white\">\r\n\r\n        <ImageView\r\n            android:id=\"@+id/btnBack\"\r\n            android:layout_width=\"24dp\"\r\n            android:layout_height=\"24dp\"\r\n            android:src=\"@drawable/outline_arrow_back_ios_new_24\"\r\n            app:tint=\"#000000\" />\r\n\r\n        <TextView\r\n            android:layout_width=\"wrap_content\"\r\n            android:layout_height=\"wrap_content\"\r\n            android:layout_marginStart=\"12dp\"\r\n            android:text=\"Đăng ký tài khoản\"\r\n            android:textSize=\"18sp\"\r\n            android:textStyle=\"bold\"\r\n            android:textColor=\"#000000\" />\r\n\r\n    </LinearLayout>\r\n\r\n    <!-- Body -->\r\n    <ScrollView\r\n        android:layout_width=\"match_parent\"\r\n        android:layout_height=\"0dp\"\r\n        android:layout_weight=\"1\"\r\n        android:fillViewport=\"true\">\r\n\r\n        <LinearLayout\r\n            android:layout_width=\"match_parent\"\r\n            android:layout_height=\"wrap_content\"\r\n            android:orientation=\"vertical\"\r\n            android:padding=\"20dp\"\r\n            android:paddingBottom=\"100dp\">\r\n\r\n            <TextView\r\n                android:layout_width=\"wrap_content\"\r\n                android:layout_height=\"wrap_content\"\r\n                android:text=\"Hoàn tất thiết lập\"\r\n                android:textSize=\"16sp\"\r\n                android:textStyle=\"bold\"\r\n                android:textColor=\"#000000\"\r\n                android:layout_marginBottom=\"8dp\" />\r\n\r\n            <TextView\r\n                android:layout_width=\"wrap_content\"\r\n                android:layout_height=\"wrap_content\"\r\n                android:text=\"Tên đăng nhập:\"\r\n                android:textSize=\"14sp\"\r\n                android:textColor=\"#000000\"\r\n                android:fontFamily=\"@font/nunito_sans\"\r\n                android:layout_marginTop=\"16dp\"\r\n                android:layout_marginBottom=\"8dp\" />\r\n\r\n            <!-- Tên đăng nhập (disabled - lấy từ số điện thoại) -->\r\n            <androidx.cardview.widget.CardView\r\n                android:layout_width=\"match_parent\"\r\n                android:layout_height=\"wrap_content\"\r\n                android:layout_marginBottom=\"16dp\"\r\n                app:cardCornerRadius=\"4dp\"\r\n                app:cardElevation=\"4dp\"\r\n                app:cardMaxElevation=\"4dp\"\r\n                app:cardUseCompatPadding=\"true\"\r\n                app:cardBackgroundColor=\"#FFFFFF\">\r\n\r\n                <com.google.android.material.textfield.TextInputLayout\r\n                    android:id=\"@+id/tilUsername\"\r\n                    style=\"@style/Widget.MaterialComponents.TextInputLayout.FilledBox.Dense\"\r\n                    android:layout_width=\"match_parent\"\r\n                    android:layout_height=\"wrap_content\"\r\n                    android:hint=\"\"\r\n                    app:boxBackgroundColor=\"@android:color/transparent\"\r\n                    app:boxStrokeWidth=\"0dp\"\r\n                    app:boxStrokeWidthFocused=\"0dp\">\r\n\r\n                    <com.google.android.material.textfield.TextInputEditText\r\n                        android:id=\"@+id/edtUsername\"\r\n                        android:layout_width=\"match_parent\"\r\n                        android:layout_height=\"wrap_content\"\r\n                        android:fontFamily=\"@font/nunito_sans\"\r\n                        android:inputType=\"text\"\r\n                        android:textColor=\"@color/black\"\r\n                        android:background=\"@color/white\"\r\n                        android:textSize=\"16sp\"\r\n                        android:enabled=\"false\" />\r\n                </com.google.android.material.textfield.TextInputLayout>\r\n\r\n            </androidx.cardview.widget.CardView>\r\n\r\n            <TextView\r\n                android:layout_width=\"wrap_content\"\r\n                android:layout_height=\"wrap_content\"\r\n                android:text=\"Mật khẩu đăng nhập:\"\r\n                android:textSize=\"14sp\"\r\n                android:textColor=\"#000000\"\r\n                android:fontFamily=\"@font/nunito_sans\"\r\n                android:layout_marginBottom=\"8dp\" />\r\n\r\n            <!-- Mật khẩu đăng nhập -->\r\n            <androidx.cardview.widget.CardView\r\n                android:layout_width=\"match_parent\"\r\n                android:layout_height=\"wrap_content\"\r\n                android:layout_marginBottom=\"8dp\"\r\n                app:cardCornerRadius=\"4dp\"\r\n                app:cardElevation=\"4dp\"\r\n                app:cardMaxElevation=\"4dp\"\r\n                app:cardUseCompatPadding=\"true\"\r\n                app:cardBackgroundColor=\"#FFFFFF\">\r\n\r\n                <com.google.android.material.textfield.TextInputLayout\r\n                    android:id=\"@+id/tilPassword\"\r\n                    style=\"@style/Widget.MaterialComponents.TextInputLayout.FilledBox.Dense\"\r\n                    android:layout_width=\"match_parent\"\r\n                    android:layout_height=\"wrap_content\"\r\n                    android:hint=\"NHẬP MẬT KHẨU\"\r\n                    app:boxBackgroundColor=\"@android:color/transparent\"\r\n                    app:boxStrokeWidth=\"0dp\"\r\n                    app:boxStrokeWidthFocused=\"0dp\"\r\n                    android:textColorHint=\"#A3A3A3\"\r\n                    app:hintTextColor=\"@color/text_input_hint_color\"\r\n                    app:endIconMode=\"password_toggle\"\r\n                    app:endIconTint=\"#000000\">\r\n\r\n                    <com.google.android.material.textfield.TextInputEditText\r\n                        android:id=\"@+id/edtPassword\"\r\n                        android:layout_width=\"match_parent\"\r\n                        android:layout_height=\"wrap_content\"\r\n                        android:fontFamily=\"@font/nunito_sans\"\r\n                        android:inputType=\"textPassword\"\r\n                        android:textColor=\"@color/black\"\r\n                        android:background=\"@color/white\"\r\n                        android:textCursorDrawable=\"@drawable/cursor_black\"\r\n                        android:textSize=\"16sp\" />\r\n                </com.google.android.material.textfield.TextInputLayout>\r\n\r\n            </androidx.cardview.widget.CardView>\r\n\r\n            <!-- Yêu cầu mật khẩu -->\r\n            <TextView\r\n                android:layout_width=\"wrap_content\"\r\n                android:layout_height=\"wrap_content\"\r\n                android:text=\"Yêu cầu mật khẩu:\"\r\n                android:textSize=\"12sp\"\r\n                android:textColor=\"#000000\"\r\n                android:fontFamily=\"@font/nunito_sans\"\r\n                android:layout_marginBottom=\"4dp\" />\r\n\r\n            <TextView\r\n                android:layout_width=\"wrap_content\"\r\n                android:layout_height=\"wrap_content\"\r\n                android:text=\"• Ít nhất 8 ký tự\\n• Có chữ hoa và chữ thường\\n• Có ít nhất 1 chữ số\\n• Có ít nhất 1 ký tự đặc biệt (!@#$)\"\r\n                android:textSize=\"12sp\"\r\n                android:textColor=\"#666666\"\r\n                android:fontFamily=\"@font/nunito_sans\"\r\n                android:layout_marginBottom=\"16dp\" />\r\n\r\n            <TextView\r\n                android:layout_width=\"wrap_content\"\r\n                android:layout_height=\"wrap_content\"\r\n                android:text=\"Xác nhận lại mật khẩu:\"\r\n                android:textSize=\"14sp\"\r\n                android:textColor=\"#000000\"\r\n                android:fontFamily=\"@font/nunito_sans\"\r\n                android:layout_marginBottom=\"8dp\" />\r\n\r\n            <!-- Xác nhận lại mật khẩu -->\r\n            <androidx.cardview.widget.CardView\r\n                android:layout_width=\"match_parent\"\r\n                android:layout_height=\"wrap_content\"\r\n                android:layout_marginBottom=\"16dp\"\r\n                app:cardCornerRadius=\"4dp\"\r\n                app:cardElevation=\"4dp\"\r\n                app:cardMaxElevation=\"4dp\"\r\n                app:cardUseCompatPadding=\"true\"\r\n                app:cardBackgroundColor=\"#FFFFFF\">\r\n\r\n                <com.google.android.material.textfield.TextInputLayout\r\n                    android:id=\"@+id/tilConfirmPassword\"\r\n                    style=\"@style/Widget.MaterialComponents.TextInputLayout.FilledBox.Dense\"\r\n                    android:layout_width=\"match_parent\"\r\n                    android:layout_height=\"wrap_content\"\r\n                    android:hint=\"XÁC NHẬN LẠI MẬT KHẨU\"\r\n                    app:boxBackgroundColor=\"@android:color/transparent\"\r\n                    app:boxStrokeWidth=\"0dp\"\r\n                    app:boxStrokeWidthFocused=\"0dp\"\r\n                    android:textColorHint=\"#A3A3A3\"\r\n                    app:hintTextColor=\"@color/text_input_hint_color\"\r\n                    app:endIconMode=\"password_toggle\"\r\n                    app:endIconTint=\"#000000\">\r\n\r\n                    <com.google.android.material.textfield.TextInputEditText\r\n                        android:id=\"@+id/edtConfirmPassword\"\r\n                        android:layout_width=\"match_parent\"\r\n                        android:layout_height=\"wrap_content\"\r\n                        android:fontFamily=\"@font/nunito_sans\"\r\n                        android:inputType=\"textPassword\"\r\n                        android:textColor=\"@color/black\"\r\n                        android:background=\"@color/white\"\r\n                        android:textCursorDrawable=\"@drawable/cursor_black\"\r\n                        android:textSize=\"16sp\" />\r\n                </com.google.android.material.textfield.TextInputLayout>\r\n\r\n            </androidx.cardview.widget.CardView>\r\n\r\n        </LinearLayout>\r\n    </ScrollView>\r\n\r\n    <!-- Nút tạo tài khoản -->\r\n    <com.google.android.material.button.MaterialButton\r\n        android:id=\"@+id/btnCreateAccount\"\r\n        android:layout_width=\"match_parent\"\r\n        android:layout_height=\"56dp\"\r\n        android:layout_marginStart=\"20dp\"\r\n        android:layout_marginEnd=\"20dp\"\r\n        android:layout_marginBottom=\"20dp\"\r\n        android:text=\"TẠO TÀI KHOẢN\"\r\n        android:textColor=\"#FFFFFF\"\r\n        android:textStyle=\"bold\"\r\n        android:textSize=\"16sp\"\r\n        android:backgroundTint=\"#000000\"\r\n        app:cornerRadius=\"5dp\" />\r\n\r\n</LinearLayout>\r\n
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/app/src/main/res/layout/activity_register5.xml b/app/src/main/res/layout/activity_register5.xml
--- a/app/src/main/res/layout/activity_register5.xml	(revision 258f67465d9c97da1d54ee045196060b3376b7fb)
+++ b/app/src/main/res/layout/activity_register5.xml	(date 1766116789705)
@@ -86,10 +86,12 @@
                     style="@style/Widget.MaterialComponents.TextInputLayout.FilledBox.Dense"
                     android:layout_width="match_parent"
                     android:layout_height="wrap_content"
-                    android:hint=""
+                    android:hint="Tên đăng nhập"
                     app:boxBackgroundColor="@android:color/transparent"
                     app:boxStrokeWidth="0dp"
-                    app:boxStrokeWidthFocused="0dp">
+                    app:boxStrokeWidthFocused="0dp"
+                    android:textColorHint="#A3A3A3"
+                    app:hintTextColor="@color/text_input_hint_color">
 
                     <com.google.android.material.textfield.TextInputEditText
                         android:id="@+id/edtUsername"
@@ -163,14 +165,51 @@
                 android:fontFamily="@font/nunito_sans"
                 android:layout_marginBottom="4dp" />
 
-            <TextView
-                android:layout_width="wrap_content"
-                android:layout_height="wrap_content"
-                android:text="• Ít nhất 8 ký tự\n• Có chữ hoa và chữ thường\n• Có ít nhất 1 chữ số\n• Có ít nhất 1 ký tự đặc biệt (!@#$)"
-                android:textSize="12sp"
-                android:textColor="#666666"
-                android:fontFamily="@font/nunito_sans"
-                android:layout_marginBottom="16dp" />
+            <LinearLayout
+                android:layout_width="match_parent"
+                android:layout_height="wrap_content"
+                android:orientation="vertical"
+                android:layout_marginBottom="16dp">
+
+                <TextView
+                    android:id="@+id/tvRuleLength"
+                    android:layout_width="wrap_content"
+                    android:layout_height="wrap_content"
+                    android:text="• Ít nhất 8 ký tự"
+                    android:textSize="12sp"
+                    android:textColor="#666666"
+                    android:fontFamily="@font/nunito_sans"
+                    android:paddingBottom="2dp"/>
+
+                <TextView
+                    android:id="@+id/tvRuleUpperLower"
+                    android:layout_width="wrap_content"
+                    android:layout_height="wrap_content"
+                    android:text="• Có chữ hoa và chữ thường"
+                    android:textSize="12sp"
+                    android:textColor="#666666"
+                    android:fontFamily="@font/nunito_sans"
+                    android:paddingBottom="2dp"/>
+
+                <TextView
+                    android:id="@+id/tvRuleDigit"
+                    android:layout_width="wrap_content"
+                    android:layout_height="wrap_content"
+                    android:text="• Có ít nhất 1 chữ số"
+                    android:textSize="12sp"
+                    android:textColor="#666666"
+                    android:fontFamily="@font/nunito_sans"
+                    android:paddingBottom="2dp"/>
+
+                <TextView
+                    android:id="@+id/tvRuleSpecial"
+                    android:layout_width="wrap_content"
+                    android:layout_height="wrap_content"
+                    android:text="• Có ít nhất 1 ký tự đặc biệt"
+                    android:textSize="12sp"
+                    android:textColor="#666666"
+                    android:fontFamily="@font/nunito_sans"/>
+            </LinearLayout>
 
             <TextView
                 android:layout_width="wrap_content"
Index: app/src/main/java/com/example/vibebank/ui/register/OtpBottomSheetDialog.java
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/app/src/main/java/com/example/vibebank/ui/register/OtpBottomSheetDialog.java b/app/src/main/java/com/example/vibebank/ui/OtpBottomSheetDialog.java
rename from app/src/main/java/com/example/vibebank/ui/register/OtpBottomSheetDialog.java
rename to app/src/main/java/com/example/vibebank/ui/OtpBottomSheetDialog.java
--- a/app/src/main/java/com/example/vibebank/ui/register/OtpBottomSheetDialog.java	(revision 258f67465d9c97da1d54ee045196060b3376b7fb)
+++ b/app/src/main/java/com/example/vibebank/ui/OtpBottomSheetDialog.java	(date 1766126453760)
@@ -1,4 +1,4 @@
-package com.example.vibebank.ui.register;
+package com.example.vibebank.ui;
 
 import android.app.Dialog;
 import android.content.Context;
Index: app/src/main/java/com/example/vibebank/ui/register/RegisterViewModel.java
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+>package com.example.vibebank.ui.register;\r\n\r\nimport androidx.lifecycle.ViewModel;\r\nimport com.example.vibebank.data.manager.RegisterDataManager;\r\n\r\npublic class RegisterViewModel extends ViewModel {\r\n    private final RegisterDataManager dataManager;\r\n\r\n    public RegisterViewModel() {\r\n        this.dataManager = RegisterDataManager.getInstance();\r\n    }\r\n\r\n    public void saveStep1(String email, String phone, String cccd) {\r\n        dataManager.setEmail(email);\r\n        dataManager.setPhone(phone);\r\n        dataManager.setCccd(cccd);\r\n    }\r\n\r\n    public void saveStep2(String fullName, String birthDate, String gender, String address, String issueDate) {\r\n        dataManager.setFullName(fullName);\r\n        dataManager.setBirthDate(birthDate);\r\n        dataManager.setGender(gender);\r\n        dataManager.setAddress(address);\r\n        dataManager.setIssueDate(issueDate);\r\n    }\r\n\r\n    public void saveStep3(String frontPath, String backPath) {\r\n        dataManager.setFrontIdCardPath(frontPath);\r\n        dataManager.setBackIdCardPath(backPath);\r\n    }\r\n\r\n    public String getFrontImage() { return dataManager.getFrontIdCardPath(); }\r\n    public String getBackImage() { return dataManager.getBackIdCardPath(); }\r\n}
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/app/src/main/java/com/example/vibebank/ui/register/RegisterViewModel.java b/app/src/main/java/com/example/vibebank/ui/register/RegisterViewModel.java
--- a/app/src/main/java/com/example/vibebank/ui/register/RegisterViewModel.java	(revision 258f67465d9c97da1d54ee045196060b3376b7fb)
+++ b/app/src/main/java/com/example/vibebank/ui/register/RegisterViewModel.java	(date 1766125719851)
@@ -1,11 +1,93 @@
 package com.example.vibebank.ui.register;
 
+import android.util.Log;
+
+import androidx.lifecycle.MutableLiveData;
 import androidx.lifecycle.ViewModel;
 import com.example.vibebank.data.manager.RegisterDataManager;
+import com.example.vibebank.utils.PasswordUtils;
+import com.google.firebase.auth.FirebaseAuth;
+import com.google.firebase.auth.FirebaseUser;
+import com.google.firebase.firestore.FirebaseFirestore;
+import com.google.firebase.firestore.WriteBatch;
+
+import java.util.Date;
+import java.util.HashMap;
+import java.util.Map;
 
 public class RegisterViewModel extends ViewModel {
     private final RegisterDataManager dataManager;
 
+    // LiveData chứa thông báo lỗi (Nếu null nghĩa là hợp lệ)
+    public MutableLiveData<String> emailError = new MutableLiveData<>();
+    public MutableLiveData<String> cccdError = new MutableLiveData<>();
+    public MutableLiveData<String> phoneError = new MutableLiveData<>();
+
+    // LiveData để chặn nút Next khi đang check (Loading)
+    public MutableLiveData<Boolean> isLoading = new MutableLiveData<>(false);
+
+    public MutableLiveData<Boolean> registrationResult = new MutableLiveData<>();
+
+    public MutableLiveData<CheckResult> finalCheckAction = new MutableLiveData<>();
+
+    public static class CheckResult {
+        public boolean isSuccess;
+        public String errorMsg;
+        public String errorField;
+
+        public CheckResult(boolean isSuccess, String errorMsg, String errorField) {
+            this.isSuccess = isSuccess;
+            this.errorMsg = errorMsg;
+            this.errorField = errorField;
+        }
+    }
+
+    public void performFinalCheck(String email, String phone, String cccd) {
+        isLoading.setValue(true); // Báo Activity hiện loading
+        FirebaseFirestore db = FirebaseFirestore.getInstance();
+
+        // BƯỚC 1: CHECK EMAIL
+        db.collection("users").whereEqualTo("email", email).get()
+                .addOnSuccessListener(emailSnap -> {
+                    if (!emailSnap.isEmpty()) {
+                        isLoading.setValue(false);
+                        finalCheckAction.setValue(new CheckResult(false, "Email này đã được sử dụng!", "EMAIL"));
+                        return;
+                    }
+
+                    // BƯỚC 2: CHECK SỐ ĐIỆN THOẠI
+                    db.collection("users").whereEqualTo("phone_number", phone).get()
+                            .addOnSuccessListener(phoneSnap -> {
+                                if (!phoneSnap.isEmpty()) {
+                                    isLoading.setValue(false);
+                                    finalCheckAction.setValue(new CheckResult(false, "Số điện thoại này đã được đăng ký!", "PHONE"));
+                                    return;
+                                }
+
+                                // BƯỚC 3: CHECK CCCD
+                                db.collection("kyc_documents").whereEqualTo("id_number", cccd).get()
+                                        .addOnSuccessListener(cccdSnap -> {
+                                            isLoading.setValue(false); // Tắt loading dù thành công hay thất bại
+                                            if (!cccdSnap.isEmpty()) {
+                                                finalCheckAction.setValue(new CheckResult(false, "Số CCCD này đã tồn tại!", "CCCD"));
+                                            } else {
+                                                // --- TẤT CẢ ĐỀU SẠCH ---
+                                                finalCheckAction.setValue(new CheckResult(true, null, null));
+                                            }
+                                        })
+                                        .addOnFailureListener(e -> handleCheckError("Lỗi kiểm tra CCCD"));
+                            })
+                            .addOnFailureListener(e -> handleCheckError("Lỗi kiểm tra SĐT"));
+                })
+                .addOnFailureListener(e -> handleCheckError("Lỗi kiểm tra Email"));
+    }
+
+    private void handleCheckError(String msg) {
+        isLoading.setValue(false);
+        // Lỗi mạng thì cho phép đi tiếp hoặc báo lỗi tùy bạn, ở đây mình báo lỗi
+        finalCheckAction.setValue(new CheckResult(false, msg, "GENERAL"));
+    }
+
     public RegisterViewModel() {
         this.dataManager = RegisterDataManager.getInstance();
     }
@@ -16,6 +98,78 @@
         dataManager.setCccd(cccd);
     }
 
+    public void checkEmailExistence(String email) {
+        if (email.isEmpty()) return;
+
+        isLoading.setValue(true);
+        FirebaseFirestore db = FirebaseFirestore.getInstance();
+
+        db.collection("users")
+                .whereEqualTo("email", email)
+                .get()
+                .addOnSuccessListener(querySnapshot -> {
+                    isLoading.setValue(false);
+                    if (!querySnapshot.isEmpty()) {
+                        // Tìm thấy -> Báo lỗi
+                        emailError.setValue("Email này đã được đăng ký!");
+                    } else {
+                        // Không tìm thấy -> Hợp lệ (null)
+                        emailError.setValue(null);
+                    }
+                })
+                .addOnFailureListener(e -> {
+                    isLoading.setValue(false);
+                    // Lỗi mạng thì tạm thời bỏ qua hoặc báo lỗi chung
+                    emailError.setValue(null);
+                });
+    }
+
+    public void checkCccdExistence(String cccd) {
+        if (cccd.isEmpty()) return;
+
+        isLoading.setValue(true);
+        FirebaseFirestore db = FirebaseFirestore.getInstance();
+
+        db.collection("kyc_documents")
+                .whereEqualTo("id_number", cccd)
+                .get()
+                .addOnSuccessListener(querySnapshot -> {
+                    isLoading.setValue(false);
+                    if (!querySnapshot.isEmpty()) {
+                        cccdError.setValue("Số CCCD này đã tồn tại trong hệ thống!");
+                    } else {
+                        cccdError.setValue(null);
+                    }
+                })
+                .addOnFailureListener(e -> {
+                    isLoading.setValue(false);
+                    cccdError.setValue(null);
+                });
+    }
+
+    public void checkPhoneExistence(String phone) {
+        if (phone.isEmpty()) return;
+        isLoading.setValue(true);
+        FirebaseFirestore db = FirebaseFirestore.getInstance();
+
+        db.collection("users")
+                .whereEqualTo("phone_number", phone)
+                .get()
+                .addOnSuccessListener(querySnapshot -> {
+                    // isLoading.setValue(false); // Khoan hãy tắt loading ở đây để dùng cho chuỗi chain
+                    if (!querySnapshot.isEmpty()) {
+                        phoneError.setValue("Số điện thoại này đã được đăng ký!");
+                        isLoading.setValue(false); // Tìm thấy lỗi thì tắt loading
+                    } else {
+                        phoneError.setValue(null); // Không trùng -> OK
+                        // Lưu ý: Không tắt loading ở đây để Activity xử lý tiếp bước sau
+                    }
+                })
+                .addOnFailureListener(e -> {
+                    isLoading.setValue(false);
+                    phoneError.setValue(null); // Lỗi mạng tạm thời cho qua
+                });
+    }
     public void saveStep2(String fullName, String birthDate, String gender, String address, String issueDate) {
         dataManager.setFullName(fullName);
         dataManager.setBirthDate(birthDate);
@@ -28,7 +182,85 @@
         dataManager.setFrontIdCardPath(frontPath);
         dataManager.setBackIdCardPath(backPath);
     }
+//
+//    public String getFrontImage() { return dataManager.getFrontIdCardPath(); }
+//    public String getBackImage() { return dataManager.getBackIdCardPath(); }
+
+    public String getFullName() { return dataManager.getFullName(); }
+    public String getBirthDate() { return dataManager.getBirthDate(); }
+    public String getGender() { return dataManager.getGender(); }
+    public String getCccd() { return dataManager.getCccd(); }
+    public String getAddress() { return dataManager.getAddress(); }
+    public String getIssueDate() { return dataManager.getIssueDate(); }
+    public String getPhone() { return dataManager.getPhone(); }
+
+    public void saveAccountInfo(String password) {
+        dataManager.setPassword(password);
+        dataManager.setUsername(dataManager.getPhone());
+    }
+
+    public void registerUser() {
+        FirebaseFirestore db = FirebaseFirestore.getInstance();
+        FirebaseUser currentUser = FirebaseAuth.getInstance().getCurrentUser();
+
+        if (currentUser == null) {
+            // Chưa đăng nhập (chưa verify OTP xong)
+            registrationResult.postValue(false);
+            return;
+        }
+
+        String uid = currentUser.getUid();
+        // --- 1. CHUẨN BỊ DỮ LIỆU (Mapping từ DataManager sang Map) ---
+
+        // A. Data cho Collection "users"
+        Map<String, Object> userMap = new HashMap<>();
+        userMap.put("full_name", dataManager.getFullName());
+        userMap.put("phone_number", dataManager.getPhone());
+        userMap.put("email", dataManager.getEmail());
+        userMap.put("address", dataManager.getAddress());
+        userMap.put("created_at", new Date());
+        String rawPassword = dataManager.getPassword();
+        String hashedPassword = PasswordUtils.hashPassword(rawPassword);
+        userMap.put("password_hash", hashedPassword);
+
+        // B. Data cho Collection "kyc_documents"
+        Map<String, Object> kycMap = new HashMap<>();
+        kycMap.put("id_number", dataManager.getCccd());
+        kycMap.put("issued_date", dataManager.getIssueDate());
+        kycMap.put("issued_place", "Cục CSQLHC về TTXH");
+        kycMap.put("front_image_url", dataManager.getFrontIdCardPath()); // Sau này cần upload ảnh lên Storage lấy link
+        kycMap.put("back_image_url", dataManager.getBackIdCardPath());
+
+        // C. Data cho Collection "accounts"
+        Map<String, Object> accountMap = new HashMap<>();
+        accountMap.put("account_number", dataManager.getPhone()); // Dùng SĐT làm số tài khoản
+        accountMap.put("account_type", "checking");
+        accountMap.put("balance", 0); // Số dư ban đầu
+        accountMap.put("created_at", new Date());
+
+        // --- 2. THỰC HIỆN GHI BATCH (Ghi 1 lần cả 3 bảng) ---
+        WriteBatch batch = db.batch();
+
+        // Định nghĩa đường dẫn lưu trữ
+        // users/{uid}
+        batch.set(db.collection("users").document(uid), userMap);
 
-    public String getFrontImage() { return dataManager.getFrontIdCardPath(); }
-    public String getBackImage() { return dataManager.getBackIdCardPath(); }
+        // kyc_documents/{uid} (Dùng UID làm ID luôn cho dễ truy xuất 1-1)
+        batch.set(db.collection("kyc_documents").document(uid), kycMap);
+
+        // accounts/{uid}
+        batch.set(db.collection("accounts").document(uid), accountMap);
+
+        // --- 3. CAM KẾT GHI (COMMIT) ---
+        batch.commit()
+                .addOnSuccessListener(aVoid -> {
+                    Log.d("Firebase", "Đăng ký thành công toàn bộ dữ liệu!");
+                    dataManager.clearData(); // Xóa dữ liệu tạm
+                    registrationResult.postValue(true);
+                })
+                .addOnFailureListener(e -> {
+                    Log.e("Firebase", "Lỗi ghi database: " + e.getMessage());
+                    registrationResult.postValue(false);
+                });
+    }
 }
\ No newline at end of file
Index: app/src/main/java/com/example/vibebank/ui/forgotpassword/ForgotPasswordViewModel.java
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/app/src/main/java/com/example/vibebank/ui/forgotpassword/ForgotPasswordViewModel.java b/app/src/main/java/com/example/vibebank/ui/forgotpassword/ForgotPasswordViewModel.java
new file mode 100644
--- /dev/null	(date 1766138416706)
+++ b/app/src/main/java/com/example/vibebank/ui/forgotpassword/ForgotPasswordViewModel.java	(date 1766138416706)
@@ -0,0 +1,70 @@
+package com.example.vibebank.ui.forgotpassword;
+
+import androidx.lifecycle.MutableLiveData;
+import androidx.lifecycle.ViewModel;
+import com.google.firebase.firestore.DocumentSnapshot;
+import com.google.firebase.firestore.FirebaseFirestore;
+
+public class ForgotPasswordViewModel extends ViewModel {
+
+    public MutableLiveData<Boolean> isLoading = new MutableLiveData<>(false);
+    public MutableLiveData<String> errorMessage = new MutableLiveData<>();
+    // Trả về UID nếu xác thực thông tin thành công
+    public MutableLiveData<String> verifiedUid = new MutableLiveData<>();
+
+    public void verifyUserInfo(String fullName, String cccd, String phone) {
+        isLoading.setValue(true);
+        FirebaseFirestore db = FirebaseFirestore.getInstance();
+
+        // 1. Tìm user theo số điện thoại trước (Vì SĐT là duy nhất)
+        db.collection("users")
+                .whereEqualTo("phone_number", phone)
+                .get()
+                .addOnSuccessListener(querySnapshot -> {
+                    if (querySnapshot.isEmpty()) {
+                        isLoading.setValue(false);
+                        errorMessage.setValue("Số điện thoại này chưa được đăng ký!");
+                    } else {
+                        // 2. Lấy thông tin user và check Tên
+                        DocumentSnapshot userDoc = querySnapshot.getDocuments().get(0);
+                        String dbName = userDoc.getString("full_name");
+                        String uid = userDoc.getId();
+
+                        if (dbName == null || !dbName.equalsIgnoreCase(fullName)) {
+                            isLoading.setValue(false);
+                            errorMessage.setValue("Thông tin không trùng khớp!");
+                            return;
+                        }
+
+                        // 3. Check tiếp CCCD trong bảng kyc_documents bằng UID
+                        checkCccd(db, uid, cccd);
+                    }
+                })
+                .addOnFailureListener(e -> {
+                    isLoading.setValue(false);
+                    errorMessage.setValue("Lỗi kết nối: " + e.getMessage());
+                });
+    }
+
+    private void checkCccd(FirebaseFirestore db, String uid, String inputCccd) {
+        db.collection("kyc_documents").document(uid).get()
+                .addOnSuccessListener(documentSnapshot -> {
+                    isLoading.setValue(false);
+                    if (documentSnapshot.exists()) {
+                        String dbCccd = documentSnapshot.getString("id_number");
+                        if (dbCccd != null && dbCccd.equals(inputCccd)) {
+                            // --- TẤT CẢ KHỚP ---
+                            verifiedUid.setValue(uid);
+                        } else {
+                            errorMessage.setValue("Thông tin không trùng khớp!");
+                        }
+                    } else {
+                        errorMessage.setValue("Không tìm thấy dữ liệu định danh (KYC)!");
+                    }
+                })
+                .addOnFailureListener(e -> {
+                    isLoading.setValue(false);
+                    errorMessage.setValue("Lỗi kiểm tra CCCD: " + e.getMessage());
+                });
+    }
+}
\ No newline at end of file
Index: app/src/main/AndroidManifest.xml
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+><?xml version=\"1.0\" encoding=\"utf-8\"?>\r\n<manifest xmlns:android=\"http://schemas.android.com/apk/res/android\"\r\n    xmlns:tools=\"http://schemas.android.com/tools\">\r\n\r\n    <!-- Permissions for Google Maps -->\r\n    <uses-permission android:name=\"android.permission.INTERNET\" />\r\n    <uses-permission android:name=\"android.permission.ACCESS_FINE_LOCATION\" />\r\n    <uses-permission android:name=\"android.permission.ACCESS_COARSE_LOCATION\" />\r\n\r\n    <uses-permission android:name=\"android.permission.CAMERA\" />\r\n    <uses-feature android:name=\"android.hardware.camera\" android:required=\"true\" />\r\n\r\n    <application\r\n        android:allowBackup=\"true\"\r\n        android:dataExtractionRules=\"@xml/data_extraction_rules\"\r\n        android:fullBackupContent=\"@xml/backup_rules\"\r\n        android:icon=\"@mipmap/ic_launcher\"\r\n        android:label=\"@string/app_name\"\r\n        android:roundIcon=\"@mipmap/ic_launcher\"\r\n        android:supportsRtl=\"true\"\r\n        android:theme=\"@style/Theme.VibeBank\">\r\n        \r\n        <!-- Google Maps API Key -->\r\n        <meta-data\r\n            android:name=\"com.google.android.geo.API_KEY\"\r\n            android:value=\"AIzaSyAOVYRIgupAurZup5y1PRh8Ismb1A3lLao\" />\r\n        \r\n        <!-- Google Fonts Provider -->\r\n        <meta-data\r\n            android:name=\"preloaded_fonts\"\r\n            android:resource=\"@array/preloaded_fonts\" />\r\n        \r\n        <activity\r\n            android:name=\".ui.login.LoginActivity\"\r\n            android:exported=\"true\">\r\n            <intent-filter>\r\n                <action android:name=\"android.intent.action.MAIN\" />\r\n\r\n                <category android:name=\"android.intent.category.LAUNCHER\" />\r\n            </intent-filter>\r\n        </activity>\r\n\r\n        <activity android:name=\".ui.register.RegisterActivity\"\r\n            android:windowSoftInputMode=\"adjustPan\" />\r\n        <activity android:name=\".ui.register.Register2Activity\"\r\n            android:windowSoftInputMode=\"adjustPan\" />\r\n        <activity android:name=\".ui.register.Register3Activity\"\r\n            android:windowSoftInputMode=\"adjustPan\" />\r\n        <activity android:name=\".ui.register.CustomCameraActivity\"\r\n            android:windowSoftInputMode=\"adjustPan\" />\r\n        <activity android:name=\".ui.register.Register4Activity\"\r\n            android:windowSoftInputMode=\"adjustPan\" />\r\n        <activity android:name=\".ui.register.Register5Activity\"\r\n            android:windowSoftInputMode=\"adjustPan\" />\r\n        <activity android:name=\".ForgotPasswordActivity\" \r\n            android:windowSoftInputMode=\"adjustPan\" />\r\n        <activity android:name=\".ResetPasswordActivity\" \r\n            android:windowSoftInputMode=\"adjustPan\" />\r\n        <activity android:name=\".HomeActivity\" />\r\n        <activity android:name=\".AccountManagementActivity\" \r\n            android:windowSoftInputMode=\"adjustPan\" />\r\n        <activity android:name=\".TransferActivity\" \r\n            android:windowSoftInputMode=\"adjustPan\" />\r\n        <activity android:name=\".TransferSelectBankActivity\" \r\n            android:windowSoftInputMode=\"adjustPan\" />\r\n        <activity android:name=\".TransferEnterAccountActivity\" \r\n            android:windowSoftInputMode=\"adjustPan\" />\r\n        <activity android:name=\".TransferDetailsActivity\" \r\n            android:windowSoftInputMode=\"adjustPan\" />\r\n        <activity android:name=\".TransferResultActivity\" \r\n            android:windowSoftInputMode=\"adjustPan\" />\r\n\r\n    </application>\r\n\r\n</manifest>
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/app/src/main/AndroidManifest.xml b/app/src/main/AndroidManifest.xml
--- a/app/src/main/AndroidManifest.xml	(revision 258f67465d9c97da1d54ee045196060b3376b7fb)
+++ b/app/src/main/AndroidManifest.xml	(date 1766138248547)
@@ -52,9 +52,9 @@
             android:windowSoftInputMode="adjustPan" />
         <activity android:name=".ui.register.Register5Activity"
             android:windowSoftInputMode="adjustPan" />
-        <activity android:name=".ForgotPasswordActivity" 
+        <activity android:name=".ui.forgotpassword.ForgotPasswordActivity"
             android:windowSoftInputMode="adjustPan" />
-        <activity android:name=".ResetPasswordActivity" 
+        <activity android:name=".ui.forgotpassword.ResetPasswordActivity"
             android:windowSoftInputMode="adjustPan" />
         <activity android:name=".HomeActivity" />
         <activity android:name=".AccountManagementActivity" 
Index: app/src/main/res/layout/activity_login.xml
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+><?xml version=\"1.0\" encoding=\"utf-8\"?>\r\n<androidx.constraintlayout.widget.ConstraintLayout xmlns:android=\"http://schemas.android.com/apk/res/android\"\r\n    xmlns:app=\"http://schemas.android.com/apk/res-auto\"\r\n    android:layout_width=\"match_parent\"\r\n    android:layout_height=\"match_parent\"\r\n    android:background=\"@drawable/background\">\r\n\r\n    <!-- Background Image -->\r\n    <ImageView\r\n        android:id=\"@+id/background\"\r\n        android:layout_width=\"match_parent\"\r\n        android:layout_height=\"match_parent\"\r\n        android:scaleType=\"centerCrop\"\r\n        app:layout_constraintBottom_toBottomOf=\"parent\"\r\n        app:layout_constraintEnd_toEndOf=\"parent\"\r\n        app:layout_constraintStart_toStartOf=\"parent\"\r\n        app:layout_constraintTop_toTopOf=\"parent\" />\r\n\r\n    <!-- Logo -->\r\n    <ImageView\r\n        android:id=\"@+id/logo\"\r\n        android:layout_width=\"134dp\"\r\n        android:layout_height=\"30dp\"\r\n        android:layout_marginStart=\"30dp\"\r\n        android:layout_marginTop=\"40dp\"\r\n        android:src=\"@drawable/logo\"\r\n        app:layout_constraintStart_toStartOf=\"parent\"\r\n        app:layout_constraintTop_toTopOf=\"parent\" />\r\n\r\n    <com.google.android.material.card.MaterialCardView\r\n        android:id=\"@+id/card_container\"\r\n        android:layout_width=\"0dp\"\r\n        android:layout_height=\"wrap_content\"\r\n        android:layout_marginStart=\"20dp\"\r\n        android:layout_marginEnd=\"20dp\"\r\n        app:cardBackgroundColor=\"#FFFFFF\"\r\n        app:cardCornerRadius=\"16dp\"\r\n        app:cardElevation=\"8dp\"\r\n        app:layout_constraintBottom_toBottomOf=\"parent\"\r\n        app:layout_constraintEnd_toEndOf=\"parent\"\r\n        app:layout_constraintStart_toStartOf=\"parent\"\r\n        app:layout_constraintTop_toTopOf=\"parent\">\r\n\r\n        <androidx.constraintlayout.widget.ConstraintLayout\r\n            android:layout_width=\"match_parent\"\r\n            android:layout_height=\"wrap_content\">\r\n\r\n            <androidx.constraintlayout.widget.ConstraintLayout\r\n                android:id=\"@+id/centerInside\"\r\n                android:layout_width=\"match_parent\"\r\n                android:layout_height=\"wrap_content\"\r\n                android:layout_margin=\"30dp\"\r\n                app:layout_constraintTop_toTopOf=\"parent\"\r\n                app:layout_constraintStart_toStartOf=\"parent\"\r\n                app:layout_constraintEnd_toEndOf=\"parent\"\r\n                >\r\n\r\n                <!-- Welcome Text -->\r\n                <TextView\r\n                    android:id=\"@+id/text_welcome\"\r\n                    android:layout_width=\"wrap_content\"\r\n                    android:layout_height=\"wrap_content\"\r\n                    android:fontFamily=\"@font/nunito_sans\"\r\n                    android:lineSpacingExtra=\"4dp\"\r\n                    android:text=\"Chào mừng bạn\\nđến với VibeBank\"\r\n                    android:textColor=\"#333333\"\r\n                    android:textSize=\"20sp\"\r\n                    app:layout_constraintStart_toStartOf=\"parent\"\r\n                    app:layout_constraintTop_toTopOf=\"parent\" />\r\n\r\n                <!-- Username Input -->\r\n                <com.google.android.material.textfield.TextInputLayout\r\n                    android:id=\"@+id/input_layout_username\"\r\n                    style=\"@style/Widget.MaterialComponents.TextInputLayout.FilledBox.Dense\"\r\n                    android:layout_width=\"0dp\"\r\n                    android:layout_height=\"wrap_content\"\r\n                    android:layout_marginTop=\"20dp\"\r\n                    android:hint=\"TÊN ĐĂNG NHẬP\"\r\n                    app:boxBackgroundColor=\"@android:color/transparent\"\r\n                    app:boxStrokeWidth=\"0dp\"\r\n                    app:boxStrokeWidthFocused=\"0dp\"\r\n                    android:textColorHint=\"#A3A3A3\"\r\n                    app:hintTextColor=\"@color/text_input_hint_color\"\r\n                    app:layout_constraintEnd_toEndOf=\"parent\"\r\n                    app:layout_constraintStart_toStartOf=\"parent\"\r\n                    app:layout_constraintTop_toBottomOf=\"@id/text_welcome\">\r\n\r\n                    <com.google.android.material.textfield.TextInputEditText\r\n                        android:id=\"@+id/edit_text_username\"\r\n                        android:layout_width=\"match_parent\"\r\n                        android:layout_height=\"wrap_content\"\r\n                        android:fontFamily=\"@font/nunito_sans\"\r\n                        android:inputType=\"text\"\r\n                        android:textColor=\"@color/black\"\r\n                        android:background=\"@color/white\"\r\n                        android:paddingStart=\"0dp\"\r\n                        android:textCursorDrawable=\"@drawable/cursor_black\"\r\n                        app:hintTextColor=\"@color/text_input_hint_color\"\r\n                        android:textSize=\"16sp\" />\r\n                </com.google.android.material.textfield.TextInputLayout>\r\n\r\n                <!-- Username Divider -->\r\n                <View\r\n                    android:id=\"@+id/divider_username\"\r\n                    android:layout_width=\"0dp\"\r\n                    android:layout_height=\"1dp\"\r\n                    android:background=\"#CCCCCC\"\r\n                    app:layout_constraintEnd_toEndOf=\"@id/input_layout_username\"\r\n                    app:layout_constraintStart_toStartOf=\"@id/input_layout_username\"\r\n                    app:layout_constraintTop_toBottomOf=\"@id/input_layout_username\" />\r\n\r\n                <!-- Password Input -->\r\n                <com.google.android.material.textfield.TextInputLayout\r\n                    android:id=\"@+id/input_layout_password\"\r\n                    style=\"@style/Widget.MaterialComponents.TextInputLayout.FilledBox.Dense\"\r\n                    android:layout_width=\"0dp\"\r\n                    android:layout_height=\"wrap_content\"\r\n                    android:layout_marginTop=\"24dp\"\r\n                    android:hint=\"MẬT KHẨU\"\r\n                    app:boxBackgroundColor=\"@android:color/transparent\"\r\n                    app:boxStrokeWidth=\"0dp\"\r\n                    app:boxStrokeWidthFocused=\"0dp\"\r\n                    android:textColorHint=\"#A3A3A3\"\r\n                    app:hintTextColor=\"@color/text_input_hint_color\"\r\n\r\n                    app:layout_constraintEnd_toEndOf=\"parent\"\r\n                    app:layout_constraintStart_toStartOf=\"parent\"\r\n                    app:layout_constraintTop_toBottomOf=\"@id/divider_username\"\r\n                    app:passwordToggleEnabled=\"true\"\r\n\r\n                    app:passwordToggleTint=\"#000000\">\r\n\r\n                    <com.google.android.material.textfield.TextInputEditText\r\n                        android:id=\"@+id/edit_text_password\"\r\n                        android:layout_width=\"match_parent\"\r\n                        android:layout_height=\"wrap_content\"\r\n                        android:fontFamily=\"@font/nunito_sans\"\r\n                        android:inputType=\"textPassword\"\r\n                        android:textColor=\"@color/black\"\r\n                        android:background=\"@color/white\"\r\n                        android:paddingStart=\"0dp\"\r\n                        android:textCursorDrawable=\"@drawable/cursor_black\"\r\n                        android:textSize=\"16sp\" />\r\n                </com.google.android.material.textfield.TextInputLayout>\r\n\r\n                <!-- Password Divider -->\r\n                <View\r\n                    android:id=\"@+id/divider_password\"\r\n                    android:layout_width=\"0dp\"\r\n                    android:layout_height=\"1dp\"\r\n                    android:background=\"#CCCCCC\"\r\n                    app:layout_constraintEnd_toEndOf=\"@id/input_layout_password\"\r\n                    app:layout_constraintStart_toStartOf=\"@id/input_layout_password\"\r\n                    app:layout_constraintTop_toBottomOf=\"@id/input_layout_password\" />\r\n\r\n                <!-- Create Account Link -->\r\n                <TextView\r\n                    android:id=\"@+id/text_create_account\"\r\n                    android:layout_width=\"wrap_content\"\r\n                    android:layout_height=\"wrap_content\"\r\n                    android:layout_marginTop=\"10dp\"\r\n                    android:clickable=\"true\"\r\n                    android:focusable=\"true\"\r\n                    android:fontFamily=\"@font/nunito_sans\"\r\n                    android:text=\"Tạo tài khoản\"\r\n                    android:textColor=\"#000000\"\r\n                    android:textSize=\"16sp\"\r\n                    app:layout_constraintStart_toStartOf=\"parent\"\r\n                    app:layout_constraintTop_toBottomOf=\"@id/divider_password\" />\r\n\r\n                <!-- Forgot Password Link -->\r\n                <TextView\r\n                    android:id=\"@+id/text_forgot_password\"\r\n                    android:layout_width=\"wrap_content\"\r\n                    android:layout_height=\"wrap_content\"\r\n                    android:layout_marginTop=\"10dp\"\r\n                    android:clickable=\"true\"\r\n                    android:focusable=\"true\"\r\n                    android:fontFamily=\"@font/nunito_sans\"\r\n                    android:text=\"Quên mật khẩu?\"\r\n                    android:textColor=\"#000000\"\r\n                    android:textSize=\"16sp\"\r\n                    app:layout_constraintEnd_toEndOf=\"parent\"\r\n                    app:layout_constraintTop_toBottomOf=\"@id/divider_password\" />\r\n\r\n            </androidx.constraintlayout.widget.ConstraintLayout>\r\n\r\n            <!-- Login Button -->\r\n            <com.google.android.material.button.MaterialButton\r\n                android:id=\"@+id/button_login\"\r\n                android:layout_width=\"match_parent\"\r\n                android:layout_height=\"64dp\"\r\n                android:backgroundTint=\"#1A1A1A\"\r\n                android:fontFamily=\"@font/nunito_sans\"\r\n                android:text=\"ĐĂNG NHẬP\"\r\n                android:layout_marginTop=\"20dp\"\r\n                android:layout_marginBottom=\"-5dp\"\r\n                android:textColor=\"@android:color/white\"\r\n                android:textSize=\"18sp\"\r\n                android:textStyle=\"bold\"\r\n                app:cornerRadius=\"0dp\"\r\n                app:layout_constraintBottom_toBottomOf=\"parent\"\r\n                app:layout_constraintEnd_toEndOf=\"parent\"\r\n                app:layout_constraintHorizontal_bias=\"1.0\"\r\n                app:layout_constraintStart_toStartOf=\"parent\"\r\n                app:layout_constraintTop_toBottomOf=\"@+id/centerInside\" />\r\n        </androidx.constraintlayout.widget.ConstraintLayout>\r\n\r\n    </com.google.android.material.card.MaterialCardView>\r\n\r\n\r\n\r\n</androidx.constraintlayout.widget.ConstraintLayout>\r\n
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/app/src/main/res/layout/activity_login.xml b/app/src/main/res/layout/activity_login.xml
--- a/app/src/main/res/layout/activity_login.xml	(revision 258f67465d9c97da1d54ee045196060b3376b7fb)
+++ b/app/src/main/res/layout/activity_login.xml	(date 1766121274658)
@@ -208,6 +208,18 @@
 
     </com.google.android.material.card.MaterialCardView>
 
-
+    <ProgressBar
+        android:id="@+id/progressBar"
+        android:layout_width="wrap_content"
+        android:layout_height="wrap_content"
+        android:visibility="gone"
+        android:elevation="10dp"
+        android:indeterminateTint="#000000"
+        android:indeterminateTintMode="src_in"
+        app:layout_constraintTop_toTopOf="parent"
+        app:layout_constraintBottom_toBottomOf="parent"
+        app:layout_constraintStart_toStartOf="parent"
+        app:layout_constraintEnd_toEndOf="parent"
+        />
 
 </androidx.constraintlayout.widget.ConstraintLayout>
Index: app/src/main/java/com/example/vibebank/ResetPasswordActivity.java
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/app/src/main/java/com/example/vibebank/ResetPasswordActivity.java b/app/src/main/java/com/example/vibebank/ui/forgotpassword/ResetPasswordActivity.java
rename from app/src/main/java/com/example/vibebank/ResetPasswordActivity.java
rename to app/src/main/java/com/example/vibebank/ui/forgotpassword/ResetPasswordActivity.java
--- a/app/src/main/java/com/example/vibebank/ResetPasswordActivity.java	(revision 258f67465d9c97da1d54ee045196060b3376b7fb)
+++ b/app/src/main/java/com/example/vibebank/ui/forgotpassword/ResetPasswordActivity.java	(date 1766138248555)
@@ -1,4 +1,4 @@
-package com.example.vibebank;
+package com.example.vibebank.ui.forgotpassword;
 
 import android.annotation.SuppressLint;
 import android.content.Intent;
@@ -15,6 +15,7 @@
 import androidx.core.view.ViewCompat;
 import androidx.core.view.WindowInsetsCompat;
 
+import com.example.vibebank.R;
 import com.example.vibebank.ui.login.LoginActivity;
 import com.google.android.material.button.MaterialButton;
 import com.google.android.material.textfield.TextInputEditText;
